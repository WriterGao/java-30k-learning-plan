# Day01 学习笔记

> **学习目标**：今天的笔记目标是"**能复述、能画图、能用代码验证**"，不要抄书。  
> **参考课件**：`00-教学课件_JVM内存模型详解.md`

---

## 1. JVM 运行时数据区（结构图 + 解释）

### 1.1 结构图

请画一张结构图（可用 ASCII，参考课件第1章）：

```
┌─────────────────────────────────────────────────────────────┐
│                    JVM运行时数据区                            │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  线程私有：                                                    │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  程序计数器   │  │  Java虚拟机栈 │  │  本地方法栈   │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│                                                               │
│  线程共享：                                                    │
│  ┌──────────────────────────────────────────────────────┐  │
│  │              Java堆                                   │  │
│  │  ┌──────────┐  ┌──────────┐                         │  │
│  │  │ 新生代   │  │ 老年代   │                         │  │
│  │  └──────────┘  └──────────┘                         │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │           方法区/元空间                                │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │           直接内存（堆外内存）                           │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 各区域详解

请逐一写清楚每个区域（参考课件第2-8章）：

#### 程序计数器
- **定义/职责**：
- **生命周期**：
- **主要存储内容**：
- **常见问题**：为什么是唯一不会OOM的区域？

#### Java虚拟机栈
- **定义/职责**：
- **生命周期**：
- **主要存储内容**：栈帧包含哪些部分？（局部变量表、操作数栈、动态链接、方法返回地址）
- **常见问题**：StackOverflowError vs OutOfMemoryError的区别？

#### 本地方法栈
- **定义/职责**：
- **生命周期**：
- **主要存储内容**：
- **常见问题**：HotSpot如何实现本地方法栈？

#### Java堆
- **定义/职责**：
- **生命周期**：
- **主要存储内容**：
- **分区结构**：新生代（Eden + Survivor）vs 老年代
- **常见问题**：为什么是GC的主战场？对象如何进入老年代？

#### 方法区/元空间
- **定义/职责**：
- **生命周期**：
- **主要存储内容**：
- **版本差异**：永久代（JDK 7）vs 元空间（JDK 8+）
- **常见问题**：什么情况下会溢出？

#### 直接内存
- **定义/职责**：
- **生命周期**：
- **主要存储内容**：
- **常见问题**：与堆内存的区别？什么情况下使用？

---

## 2. 堆内存分区与你观察到的现象

### 2.1 JVM 参数设置

- **你设置的 JVM 参数**（如 `-Xms/-Xmx/-Xmn` 等）：
  ```
  -Xms512m
  -Xmx512m
  -Xmn256m
  ```

### 2.2 VisualVM/jvisualvm 观察结果

- **你在 VisualVM/jvisualvm 里看到的曲线/截图要点**：
  - 堆内存使用率变化：
  - 新生代 vs 老年代使用情况：
  - GC频率和耗时：

### 2.3 GC 行为观察

- **你观察到的 GC 行为**（频率、暂停、回收幅度）：
  - Minor GC频率：
  - Full GC频率：
  - GC暂停时间：
  - 回收效果：

---

## 3. 对象创建过程（用你自己的话）

参考课件第9章，用自己的话描述对象创建的5个步骤：

### 步骤1：检查类是否已加载
- 

### 步骤2：分配内存
- 分配方式：指针碰撞 vs 空闲列表
- 并发安全：CAS + 失败重试 vs TLAB

### 步骤3：内存空间初始化
- 

### 步骤4：设置对象头
- Mark Word包含什么？
- 类型指针的作用？

### 步骤5：执行init方法
- 

### 对象内存布局
- 对象头（Header）：
- 实例数据（Instance Data）：
- 对齐填充（Padding）：

---

## 4. 复现与诊断（今天至少完成 1 个）

### 4.1 堆 OOM 复现

- [ ] 已完成

**复现代码**：`code/HeapOomDemo.java`

**启动命令**：
```bash
java -Xms20m -Xmx20m -XX:+HeapDumpOnOutOfMemoryError HeapOomDemo
```

**现象**：
- 异常信息：
- 堆转储文件：

**你如何定位**（日志/监控/工具）：
- 

**你如何缓解**（参数/代码/设计）：
- 

### 4.2 栈溢出复现

- [ ] 已完成

**复现代码**：`code/StackOverflowDemo.java`

**启动命令**：
```bash
java -Xss128k StackOverflowDemo
```

**现象**：
- 栈深度：
- 异常信息：

**你如何定位**：
- 

**你如何缓解**：
- 

### 4.3 元空间/类加载相关问题复现（可选）

- [ ] 已完成

**复现代码**：

**启动命令**：

**现象**：

**你如何定位**：
- 

**你如何缓解**：
- 

---

## 5. 5 分钟复述稿（面试式）

用 5 分钟讲清楚"JVM 内存模型基础"，要求：
- 先总览，再逐一解释，再给 1 个故障案例

**我的复述稿**：

```
【总览】
JVM运行时数据区分为线程私有和线程共享两大部分...

【逐一解释】
1. 程序计数器：...
2. Java虚拟机栈：...
3. 本地方法栈：...
4. Java堆：...
5. 方法区/元空间：...

【故障案例】
我曾经遇到一个堆内存溢出的问题...
```

---

## 6. 学习总结与疑问

### 6.1 今天学到的核心知识点

1. 
2. 
3. 

### 6.2 还有疑问的地方

1. 
2. 

### 6.3 下一步学习计划

- [ ] 复习课件第11章的检查清单
- [ ] 准备Day02的GC算法学习

---

> **提示**：完成笔记后，对照课件第11.2节的检查清单进行自我验收。
