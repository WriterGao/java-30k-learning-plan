# è®¾è®¡æ¨¡å¼ä¹‹ç»“æ„å‹æ¨¡å¼è¯¦è§£

> **å­¦ä¹ ç›®æ ‡**ï¼šæ·±å…¥ç†è§£ GOF 23 ç§è®¾è®¡æ¨¡å¼ä¸­çš„ 7 ç§ç»“æ„å‹æ¨¡å¼ï¼ˆé€‚é…å™¨ã€æ¡¥æ¥ã€ç»„åˆã€è£…é¥°å™¨ã€å¤–è§‚ã€äº«å…ƒã€ä»£ç†ï¼‰ï¼ŒæŒæ¡å®ƒä»¬åœ¨å®é™…é¡¹ç›®å’Œé¢è¯•ä¸­çš„åº”ç”¨åœºæ™¯ï¼Œç†è§£ Springã€JDK ä¸­ç»“æ„å‹æ¨¡å¼çš„åº”ç”¨ã€‚

---

## ç›®å½•

- [ä¸€ã€ç»“æ„å‹æ¨¡å¼æ¦‚è¿°](#ä¸€ç»“æ„å‹æ¨¡å¼æ¦‚è¿°)
  - [1.1 ä»€ä¹ˆæ˜¯ç»“æ„å‹æ¨¡å¼](#11-ä»€ä¹ˆæ˜¯ç»“æ„å‹æ¨¡å¼)
  - [1.2 ç»“æ„å‹æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³](#12-ç»“æ„å‹æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³)
  - [1.3 ä¸ƒç§ç»“æ„å‹æ¨¡å¼æ¦‚è§ˆ](#13-ä¸ƒç§ç»“æ„å‹æ¨¡å¼æ¦‚è§ˆ)
- [äºŒã€é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰](#äºŒé€‚é…å™¨æ¨¡å¼adapter)
- [ä¸‰ã€æ¡¥æ¥æ¨¡å¼ï¼ˆBridgeï¼‰](#ä¸‰æ¡¥æ¥æ¨¡å¼bridge)
- [å››ã€ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰](#å››ç»„åˆæ¨¡å¼composite)
- [äº”ã€è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰](#äº”è£…é¥°å™¨æ¨¡å¼decorator)
- [å…­ã€å¤–è§‚æ¨¡å¼ï¼ˆFacadeï¼‰](#å…­å¤–è§‚æ¨¡å¼facade)
- [ä¸ƒã€äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰](#ä¸ƒäº«å…ƒæ¨¡å¼flyweight)
- [å…«ã€ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰](#å…«ä»£ç†æ¨¡å¼proxy)
- [ä¹ã€ç»“æ„å‹æ¨¡å¼åœ¨ Spring/JDK ä¸­çš„åº”ç”¨æ€»ç»“](#ä¹ç»“æ„å‹æ¨¡å¼åœ¨-springjdk-ä¸­çš„åº”ç”¨æ€»ç»“)
- [åã€é¢è¯•é«˜é¢‘é—®é¢˜](#åé¢è¯•é«˜é¢‘é—®é¢˜)

---

# ä¸€ã€ç»“æ„å‹æ¨¡å¼æ¦‚è¿°

## 1.1 ä»€ä¹ˆæ˜¯ç»“æ„å‹æ¨¡å¼

**ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternï¼‰** å…³æ³¨çš„æ˜¯**ç±»å’Œå¯¹è±¡çš„ç»„åˆæ–¹å¼**ï¼Œé€šè¿‡ç»„åˆä¸åŒçš„ç±»æˆ–å¯¹è±¡æ¥è·å¾—æ›´å¤§çš„ç»“æ„ï¼ŒåŒæ—¶ä¿æŒç»“æ„çš„çµæ´»æ€§å’Œé«˜æ•ˆæ€§ã€‚

> ç»“æ„å‹æ¨¡å¼çš„æ ¸å¿ƒæ˜¯"**å¦‚ä½•ç»„åˆç±»å’Œå¯¹è±¡ä»¥è·å¾—æ›´å¤§çš„ç»“æ„**"ï¼Œè€Œä¸æ˜¯é€šè¿‡ç»§æ‰¿æ¥æ‰©å±•åŠŸèƒ½ã€‚

### ç»“æ„å‹æ¨¡å¼çš„æ ¸å¿ƒä»·å€¼

1. **è§£è€¦**ï¼šå°†æ¥å£ä¸å®ç°åˆ†ç¦»ï¼Œé™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦
2. **å¤ç”¨**ï¼šé€šè¿‡ç»„åˆè€Œéç»§æ‰¿ï¼Œæé«˜ä»£ç å¤ç”¨æ€§
3. **æ‰©å±•**ï¼šåœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œæ‰©å±•ç³»ç»ŸåŠŸèƒ½
4. **ç®€åŒ–**ï¼šé€šè¿‡å¤–è§‚æ¨¡å¼ç­‰ç®€åŒ–å¤æ‚å­ç³»ç»Ÿçš„ä½¿ç”¨

### ç»“æ„å‹æ¨¡å¼ vs åˆ›å»ºå‹æ¨¡å¼ vs è¡Œä¸ºå‹æ¨¡å¼

```mermaid
graph TB
    A[è®¾è®¡æ¨¡å¼ä¸‰å¤§ç±»] --> B[åˆ›å»ºå‹æ¨¡å¼<br/>å…³æ³¨å¯¹è±¡åˆ›å»º]
    A --> C[ç»“æ„å‹æ¨¡å¼<br/>å…³æ³¨ç±»å’Œå¯¹è±¡çš„ç»„åˆ]
    A --> D[è¡Œä¸ºå‹æ¨¡å¼<br/>å…³æ³¨å¯¹è±¡é—´çš„é€šä¿¡]
    
    B --> B1[å¦‚ä½•åˆ›å»ºå¯¹è±¡]
    C --> C1[å¦‚ä½•ç»„åˆç±»å’Œå¯¹è±¡]
    D --> D1[å¯¹è±¡å¦‚ä½•åä½œ]
    
    style C fill:#e1f5fe
```

| åˆ†ç±» | å…³æ³¨ç‚¹ | æ ¸å¿ƒé—®é¢˜ | å…¸å‹æ¨¡å¼ |
|------|--------|----------|----------|
| **åˆ›å»ºå‹** | å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ | å¦‚ä½•åˆ›å»ºå¯¹è±¡ï¼Ÿ | å•ä¾‹ã€å·¥å‚ã€å»ºé€ è€… |
| **ç»“æ„å‹** | ç±»å’Œå¯¹è±¡çš„ç»„åˆ | å¦‚ä½•ç»„åˆç±»å’Œå¯¹è±¡ï¼Ÿ | é€‚é…å™¨ã€ä»£ç†ã€è£…é¥°å™¨ |
| **è¡Œä¸ºå‹** | å¯¹è±¡ä¹‹é—´çš„èŒè´£åˆ†é… | å¯¹è±¡å¦‚ä½•åä½œï¼Ÿ | è§‚å¯Ÿè€…ã€ç­–ç•¥ã€æ¨¡æ¿æ–¹æ³• |

---

## 1.2 ç»“æ„å‹æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³

### ç»„åˆä¼˜äºç»§æ‰¿ï¼ˆComposition over Inheritanceï¼‰

ç»“æ„å‹æ¨¡å¼æ™®ééµå¾ª"**ç»„åˆä¼˜äºç»§æ‰¿**"çš„åŸåˆ™ï¼š

```java
// âŒ ç»§æ‰¿æ–¹å¼ï¼ˆå¼ºè€¦åˆï¼‰
class Circle extends Shape {
    // å¦‚æœ Shape æ”¹å˜ï¼ŒCircle å¿…é¡»è·Ÿç€æ”¹å˜
}

// âœ… ç»„åˆæ–¹å¼ï¼ˆå¼±è€¦åˆï¼‰
class Circle {
    private Shape shape; // ç»„åˆï¼Œè€Œéç»§æ‰¿
    // Shape æ”¹å˜ä¸å½±å“ Circle
}
```

### æ¥å£ä¸å®ç°åˆ†ç¦»

ç»“æ„å‹æ¨¡å¼é€šè¿‡**æ¥å£**æ¥å®šä¹‰æŠ½è±¡ï¼Œé€šè¿‡**å®ç°ç±»**æ¥æä¾›å…·ä½“åŠŸèƒ½ï¼Œå®ç°æ¥å£ä¸å®ç°çš„è§£è€¦ã€‚

---

## 1.3 ä¸ƒç§ç»“æ„å‹æ¨¡å¼æ¦‚è§ˆ

```mermaid
graph TB
    A[ç»“æ„å‹æ¨¡å¼ 7ç§] --> B[é€‚é…å™¨ Adapter<br/>è®©ä¸å…¼å®¹çš„æ¥å£ååŒå·¥ä½œ]
    A --> C[æ¡¥æ¥ Bridge<br/>å°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»]
    A --> D[ç»„åˆ Composite<br/>æ ‘å½¢ç»“æ„å¤„ç†]
    A --> E[è£…é¥°å™¨ Decorator<br/>åŠ¨æ€æ‰©å±•åŠŸèƒ½]
    A --> F[å¤–è§‚ Facade<br/>ç®€åŒ–å¤æ‚å­ç³»ç»Ÿ]
    A --> G[äº«å…ƒ Flyweight<br/>å…±äº«ç»†ç²’åº¦å¯¹è±¡]
    A --> H[ä»£ç† Proxy<br/>æ§åˆ¶å¯¹è±¡è®¿é—®]
    
    style B fill:#e1f5fe
    style C fill:#f3e5f5
    style D fill:#e8f5e9
    style E fill:#fff3e0
    style F fill:#fce4ec
    style G fill:#e0f2f1
    style H fill:#ffebee
```

### ä¸ƒç§ç»“æ„å‹æ¨¡å¼å¯¹æ¯”è¡¨

| æ¨¡å¼ | æ ¸å¿ƒç›®çš„ | é€‚ç”¨åœºæ™¯ | å…³é”®ç‰¹ç‚¹ |
|------|---------|---------|---------|
| **é€‚é…å™¨** | è®©ä¸å…¼å®¹çš„æ¥å£ååŒå·¥ä½œ | éœ€è¦ä½¿ç”¨ç°æœ‰ç±»ä½†æ¥å£ä¸åŒ¹é… | åŒ…è£…å™¨ã€è½¬æ¢æ¥å£ |
| **æ¡¥æ¥** | å°†æŠ½è±¡ä¸å®ç°åˆ†ç¦» | é¿å…ç±»çˆ†ç‚¸ï¼Œå¤šç»´åº¦å˜åŒ– | ç»„åˆæ›¿ä»£ç»§æ‰¿ |
| **ç»„åˆ** | æ ‘å½¢ç»“æ„å¤„ç† | éƒ¨åˆ†-æ•´ä½“å±‚æ¬¡ç»“æ„ | ç»Ÿä¸€å¶å­èŠ‚ç‚¹å’Œç»„åˆèŠ‚ç‚¹ |
| **è£…é¥°å™¨** | åŠ¨æ€æ‰©å±•åŠŸèƒ½ | éœ€è¦åŠ¨æ€æ·»åŠ åŠŸèƒ½ï¼Œé¿å…ç±»çˆ†ç‚¸ | åŒ…è£…å™¨ã€é“¾å¼è°ƒç”¨ |
| **å¤–è§‚** | ç®€åŒ–å¤æ‚å­ç³»ç»Ÿ | ä¸ºå¤æ‚å­ç³»ç»Ÿæä¾›ç»Ÿä¸€æ¥å£ | ç®€åŒ–æ¥å£ã€éšè—å¤æ‚æ€§ |
| **äº«å…ƒ** | å…±äº«ç»†ç²’åº¦å¯¹è±¡ | å¤§é‡ç›¸ä¼¼å¯¹è±¡ï¼Œå†…å­˜ä¼˜åŒ– | å…±äº«å†…éƒ¨çŠ¶æ€ï¼Œå¤–éƒ¨çŠ¶æ€åˆ†ç¦» |
| **ä»£ç†** | æ§åˆ¶å¯¹è±¡è®¿é—® | å»¶è¿ŸåŠ è½½ã€è®¿é—®æ§åˆ¶ã€å¢å¼ºåŠŸèƒ½ | ä»£ç†å¯¹è±¡æ§åˆ¶åŸå¯¹è±¡è®¿é—® |

---

# äºŒã€é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰

## 2.1 ä»€ä¹ˆæ˜¯é€‚é…å™¨æ¨¡å¼

> **å®šä¹‰**ï¼šå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ã€‚é€‚é…å™¨æ¨¡å¼ä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚

**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼šç”µæºé€‚é…å™¨ï¼ˆ220V â†’ 5Vï¼‰ã€è½¬æ¥å¤´ï¼ˆUSB-C â†’ USB-Aï¼‰

### UML ç±»å›¾

```mermaid
classDiagram
    class Target {
        <<interface>>
        +request()
    }
    
    class Adaptee {
        +specificRequest()
    }
    
    class Adapter {
        -adaptee: Adaptee
        +request()
    }
    
    class Client {
        +useTarget(Target)
    }
    
    Target <|.. Adapter
    Adapter o-- Adaptee
    Client ..> Target : uses
```

### é€‚é…å™¨æ¨¡å¼çš„ä¸‰ç§å®ç°æ–¹å¼

1. **ç±»é€‚é…å™¨**ï¼šé€šè¿‡ç»§æ‰¿å®ç°ï¼ˆJava ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œä¸å¸¸ç”¨ï¼‰
2. **å¯¹è±¡é€‚é…å™¨**ï¼šé€šè¿‡ç»„åˆå®ç°ï¼ˆæ¨èï¼‰
3. **æ¥å£é€‚é…å™¨**ï¼šç¼ºçœé€‚é…å™¨æ¨¡å¼ï¼ˆä¸ºæ¥å£æä¾›é»˜è®¤å®ç°ï¼‰

---

## 2.2 å¯¹è±¡é€‚é…å™¨ï¼ˆæ¨èï¼‰â­â­â­

### åœºæ™¯ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹æ’­æ”¾å™¨

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªéŸ³ä¹æ’­æ”¾ç³»ç»Ÿï¼Œéœ€è¦æ”¯æŒå¤šç§æ’­æ”¾å™¨ï¼Œä½†å®ƒä»¬çš„æ¥å£ä¸åŒï¼š

```java
// ç›®æ ‡æ¥å£ï¼ˆæˆ‘ä»¬ç³»ç»Ÿéœ€è¦çš„æ¥å£ï¼‰
public interface MediaPlayer {
    void play(String audioType, String fileName);
}

// å·²æœ‰çš„ç¬¬ä¸‰æ–¹æ’­æ”¾å™¨ï¼ˆä¸å…¼å®¹çš„æ¥å£ï¼‰
public class VlcPlayer {
    public void playVlc(String fileName) {
        System.out.println("VLC æ’­æ”¾å™¨æ’­æ”¾: " + fileName);
    }
}

public class Mp4Player {
    public void playMp4(String fileName) {
        System.out.println("MP4 æ’­æ”¾å™¨æ’­æ”¾: " + fileName);
    }
}

// é€‚é…å™¨ï¼šå°†ç¬¬ä¸‰æ–¹æ’­æ”¾å™¨é€‚é…åˆ°æˆ‘ä»¬çš„æ¥å£
public class MediaAdapter implements MediaPlayer {
    private VlcPlayer vlcPlayer;
    private Mp4Player mp4Player;
    
    public MediaAdapter(String audioType) {
        if ("vlc".equalsIgnoreCase(audioType)) {
            vlcPlayer = new VlcPlayer();
        } else if ("mp4".equalsIgnoreCase(audioType)) {
            mp4Player = new Mp4Player();
        }
    }
    
    @Override
    public void play(String audioType, String fileName) {
        if ("vlc".equalsIgnoreCase(audioType)) {
            vlcPlayer.playVlc(fileName);
        } else if ("mp4".equalsIgnoreCase(audioType)) {
            mp4Player.playMp4(fileName);
        }
    }
}

// å®¢æˆ·ç«¯ä½¿ç”¨
public class AudioPlayer implements MediaPlayer {
    private MediaAdapter adapter;
    
    @Override
    public void play(String audioType, String fileName) {
        if ("mp3".equalsIgnoreCase(audioType)) {
            System.out.println("å†…ç½® MP3 æ’­æ”¾å™¨æ’­æ”¾: " + fileName);
        } else if ("vlc".equalsIgnoreCase(audioType) || "mp4".equalsIgnoreCase(audioType)) {
            adapter = new MediaAdapter(audioType);
            adapter.play(audioType, fileName);
        } else {
            System.out.println("ä¸æ”¯æŒçš„æ ¼å¼: " + audioType);
        }
    }
}
```

---

## 2.3 ç±»é€‚é…å™¨ï¼ˆäº†è§£ï¼‰

ç±»é€‚é…å™¨é€šè¿‡**ç»§æ‰¿**è¢«é€‚é…è€…æ¥å®ç°é€‚é…ï¼Œä½† Java ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œæ‰€ä»¥ä¸å¸¸ç”¨ï¼š

```java
// ç±»é€‚é…å™¨ï¼ˆJava ä¸­ä¸å¸¸ç”¨ï¼Œå› ä¸ºä¸æ”¯æŒå¤šç»§æ‰¿ï¼‰
public class ClassAdapter extends Adaptee implements Target {
    @Override
    public void request() {
        specificRequest(); // è°ƒç”¨çˆ¶ç±»æ–¹æ³•
    }
}
```

---

## 2.4 æ¥å£é€‚é…å™¨ï¼ˆç¼ºçœé€‚é…å™¨æ¨¡å¼ï¼‰

ä¸ºæ¥å£æä¾›é»˜è®¤å®ç°ï¼Œå­ç±»åªéœ€å®ç°éœ€è¦çš„æ–¹æ³•ï¼š

```java
// æ¥å£ï¼ˆæ–¹æ³•å¾ˆå¤šï¼‰
public interface WindowListener {
    void windowOpened(WindowEvent e);
    void windowClosing(WindowEvent e);
    void windowClosed(WindowEvent e);
    void windowIconified(WindowEvent e);
    void windowDeiconified(WindowEvent e);
    void windowActivated(WindowEvent e);
    void windowDeactivated(WindowEvent e);
}

// ç¼ºçœé€‚é…å™¨ï¼ˆæä¾›ç©ºå®ç°ï¼‰
public abstract class WindowAdapter implements WindowListener {
    @Override public void windowOpened(WindowEvent e) {}
    @Override public void windowClosing(WindowEvent e) {}
    @Override public void windowClosed(WindowEvent e) {}
    @Override public void windowIconified(WindowEvent e) {}
    @Override public void windowDeiconified(WindowEvent e) {}
    @Override public void windowActivated(WindowEvent e) {}
    @Override public void windowDeactivated(WindowEvent e) {}
}

// å­ç±»åªéœ€å®ç°éœ€è¦çš„æ–¹æ³•
public class MyWindowListener extends WindowAdapter {
    @Override
    public void windowClosing(WindowEvent e) {
        System.out.println("çª—å£å…³é—­");
        System.exit(0);
    }
    // å…¶ä»–æ–¹æ³•ä½¿ç”¨çˆ¶ç±»çš„ç©ºå®ç°
}
```

---

## 2.5 é€‚é…å™¨æ¨¡å¼ä¼˜ç¼ºç‚¹

| ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|
| è®©ä¸å…¼å®¹çš„æ¥å£ååŒå·¥ä½œ | å¢åŠ ç³»ç»Ÿå¤æ‚åº¦ |
| æé«˜ç±»çš„å¤ç”¨æ€§ | è¿‡å¤šä½¿ç”¨ä¼šè®©ç³»ç»Ÿå˜å¾—æ··ä¹± |
| ç¬¦åˆå¼€é—­åŸåˆ™ï¼ˆå¯¹æ‰©å±•å¼€æ”¾ï¼‰ | éœ€è¦ç†è§£é€‚é…å™¨çš„è½¬æ¢é€»è¾‘ |

---

## 2.6 å®é™…åº”ç”¨

### JDK ä¸­çš„åº”ç”¨

```java
// Arrays.asList() è¿”å›çš„ List æ˜¯é€‚é…å™¨
List<String> list = Arrays.asList("a", "b", "c");
// è¿™ä¸ª List é€‚é…äº†æ•°ç»„ï¼Œä½†ä¿®æ”¹ä¼šæŠ›å‡º UnsupportedOperationException

// InputStreamReader æ˜¯é€‚é…å™¨ï¼ˆå­—èŠ‚æµ â†’ å­—ç¬¦æµï¼‰
InputStream is = new FileInputStream("file.txt");
Reader reader = new InputStreamReader(is, "UTF-8"); // é€‚é…å™¨
```

### Spring ä¸­çš„åº”ç”¨

```java
// Spring MVC ä¸­çš„ HandlerAdapter
// å°†ä¸åŒç±»å‹çš„ Controllerï¼ˆ@Controllerã€HttpRequestHandler ç­‰ï¼‰
// é€‚é…åˆ°ç»Ÿä¸€çš„ HandlerAdapter æ¥å£
public interface HandlerAdapter {
    boolean supports(Object handler);
    ModelAndView handle(HttpServletRequest request, 
                       HttpServletResponse response, 
                       Object handler) throws Exception;
}
```

---

# ä¸‰ã€æ¡¥æ¥æ¨¡å¼ï¼ˆBridgeï¼‰

## 3.1 ä»€ä¹ˆæ˜¯æ¡¥æ¥æ¨¡å¼

> **å®šä¹‰**ï¼šå°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚æ¡¥æ¥æ¨¡å¼é€šè¿‡ç»„åˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ç»§æ‰¿çš„æ–¹å¼æ¥å®ç°æŠ½è±¡å’Œå®ç°çš„è§£è€¦ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼šç”¨**ç»„åˆ**æ›¿ä»£**ç»§æ‰¿**ï¼Œé¿å…ç±»çˆ†ç‚¸ã€‚

### é—®é¢˜åœºæ™¯ï¼šç±»çˆ†ç‚¸

å‡è®¾æˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ªå›¾å½¢ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§å½¢çŠ¶ï¼ˆåœ†å½¢ã€çŸ©å½¢ï¼‰å’Œå¤šç§é¢œè‰²ï¼ˆçº¢è‰²ã€è“è‰²ã€ç»¿è‰²ï¼‰ï¼š

```java
// âŒ ä½¿ç”¨ç»§æ‰¿ï¼šä¼šäº§ç”Ÿç±»çˆ†ç‚¸
// éœ€è¦ 3 ç§å½¢çŠ¶ Ã— 3 ç§é¢œè‰² = 9 ä¸ªç±»
class RedCircle extends Circle { }
class BlueCircle extends Circle { }
class GreenCircle extends Circle { }
class RedRectangle extends Rectangle { }
class BlueRectangle extends Rectangle { }
// ... è¿˜æœ‰ 5 ä¸ªç±»
// å¦‚æœæ–°å¢ä¸€ç§é¢œè‰²ï¼Œéœ€è¦æ–°å¢ 3 ä¸ªç±»
// å¦‚æœæ–°å¢ä¸€ç§å½¢çŠ¶ï¼Œéœ€è¦æ–°å¢ 3 ä¸ªç±»
```

### UML ç±»å›¾

```mermaid
classDiagram
    class Abstraction {
        -implementor: Implementor
        +operation()
    }
    
    class RefinedAbstraction {
        +operation()
    }
    
    class Implementor {
        <<interface>>
        +operationImpl()
    }
    
    class ConcreteImplementorA {
        +operationImpl()
    }
    
    class ConcreteImplementorB {
        +operationImpl()
    }
    
    Abstraction <|-- RefinedAbstraction
    Abstraction o-- Implementor
    Implementor <|.. ConcreteImplementorA
    Implementor <|.. ConcreteImplementorB
```

---

## 3.2 æ¡¥æ¥æ¨¡å¼å®ç°

```java
// ===== å®ç°éƒ¨åˆ†ï¼ˆé¢œè‰²ï¼‰ =====
public interface Color {
    void applyColor();
}

public class Red implements Color {
    @Override
    public void applyColor() {
        System.out.print("çº¢è‰²");
    }
}

public class Blue implements Color {
    @Override
    public void applyColor() {
        System.out.print("è“è‰²");
    }
}

// ===== æŠ½è±¡éƒ¨åˆ†ï¼ˆå½¢çŠ¶ï¼‰ =====
public abstract class Shape {
    protected Color color; // æ¡¥æ¥ï¼šé€šè¿‡ç»„åˆè€Œéç»§æ‰¿
    
    public Shape(Color color) {
        this.color = color;
    }
    
    public abstract void draw();
}

public class Circle extends Shape {
    public Circle(Color color) {
        super(color);
    }
    
    @Override
    public void draw() {
        System.out.print("ç”»åœ†å½¢ï¼Œé¢œè‰²ï¼š");
        color.applyColor();
        System.out.println();
    }
}

public class Rectangle extends Shape {
    public Rectangle(Color color) {
        super(color);
    }
    
    @Override
    public void draw() {
        System.out.print("ç”»çŸ©å½¢ï¼Œé¢œè‰²ï¼š");
        color.applyColor();
        System.out.println();
    }
}

// ===== ä½¿ç”¨ =====
public class Client {
    public static void main(String[] args) {
        // çº¢è‰²åœ†å½¢
        Shape redCircle = new Circle(new Red());
        redCircle.draw(); // ç”»åœ†å½¢ï¼Œé¢œè‰²ï¼šçº¢è‰²
        
        // è“è‰²çŸ©å½¢
        Shape blueRectangle = new Rectangle(new Blue());
        blueRectangle.draw(); // ç”»çŸ©å½¢ï¼Œé¢œè‰²ï¼šè“è‰²
        
        // æ–°å¢ç»¿è‰²åœ†å½¢ï¼šåªéœ€æ–°å¢ Green ç±»ï¼Œä¸éœ€è¦æ–°å¢å½¢çŠ¶ç±»
        Shape greenCircle = new Circle(new Green());
        greenCircle.draw();
    }
}
```

**ä¼˜åŠ¿**ï¼š
- æ–°å¢å½¢çŠ¶ï¼šåªéœ€æ–°å¢å½¢çŠ¶ç±»ï¼Œä¸éœ€è¦ä¸ºæ¯ç§é¢œè‰²åˆ›å»ºå­ç±»
- æ–°å¢é¢œè‰²ï¼šåªéœ€æ–°å¢é¢œè‰²ç±»ï¼Œä¸éœ€è¦ä¸ºæ¯ç§å½¢çŠ¶åˆ›å»ºå­ç±»
- **é¿å…äº†ç±»çˆ†ç‚¸**ï¼š3 ç§å½¢çŠ¶ Ã— 3 ç§é¢œè‰² = 3 + 3 = 6 ä¸ªç±»ï¼ˆè€Œä¸æ˜¯ 9 ä¸ªï¼‰

---

## 3.3 æ¡¥æ¥æ¨¡å¼ vs ç»§æ‰¿

```mermaid
graph TB
    subgraph "âŒ ç»§æ‰¿æ–¹å¼ï¼ˆç±»çˆ†ç‚¸ï¼‰"
        A[Shape] --> B[Circle]
        A --> C[Rectangle]
        B --> D[RedCircle]
        B --> E[BlueCircle]
        B --> F[GreenCircle]
        C --> G[RedRectangle]
        C --> H[BlueRectangle]
        C --> I[GreenRectangle]
    end
    
    subgraph "âœ… æ¡¥æ¥æ–¹å¼ï¼ˆç»„åˆï¼‰"
        J[Shape<br/>ç»„åˆColor] --> K[Circle]
        J --> L[Rectangle]
        M[Color] --> N[Red]
        M --> O[Blue]
        M --> P[Green]
        K -.->|ç»„åˆ| M
        L -.->|ç»„åˆ| M
    end
```

---

## 3.4 å®é™…åº”ç”¨

### JDK ä¸­çš„åº”ç”¨

```java
// JDBC é©±åŠ¨å°±æ˜¯æ¡¥æ¥æ¨¡å¼
// DriverManagerï¼ˆæŠ½è±¡ï¼‰æ¡¥æ¥äº† Driverï¼ˆå®ç°ï¼‰
Connection conn = DriverManager.getConnection("jdbc:mysql://...");
// MySQL Driverã€Oracle Driver ç­‰æ˜¯ä¸åŒå®ç°
```

### Spring ä¸­çš„åº”ç”¨

```java
// Spring çš„ DataSource æ¡¥æ¥äº†ä¸åŒçš„æ•°æ®åº“è¿æ¥å®ç°
// DataSourceï¼ˆæŠ½è±¡ï¼‰æ¡¥æ¥äº† DriverManagerDataSourceã€HikariDataSource ç­‰ï¼ˆå®ç°ï¼‰
@Bean
public DataSource dataSource() {
    return new HikariDataSource(); // å¯ä»¥åˆ‡æ¢ä¸ºå…¶ä»–å®ç°
}
```

---

# å››ã€ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰

## 4.1 ä»€ä¹ˆæ˜¯ç»„åˆæ¨¡å¼

> **å®šä¹‰**ï¼šå°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤º"éƒ¨åˆ†-æ•´ä½“"çš„å±‚æ¬¡ç»“æ„ã€‚ç»„åˆæ¨¡å¼ä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼š**ç»Ÿä¸€å¶å­èŠ‚ç‚¹å’Œç»„åˆèŠ‚ç‚¹**ï¼Œè®©å®¢æˆ·ç«¯ä»¥ç»Ÿä¸€çš„æ–¹å¼å¤„ç†å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡ã€‚

### é€‚ç”¨åœºæ™¯

- æ–‡ä»¶ç³»ç»Ÿï¼ˆæ–‡ä»¶ + æ–‡ä»¶å¤¹ï¼‰
- ç»„ç»‡æ¶æ„ï¼ˆå‘˜å·¥ + éƒ¨é—¨ï¼‰
- èœå•ç³»ç»Ÿï¼ˆèœå•é¡¹ + å­èœå•ï¼‰
- UI ç»„ä»¶æ ‘ï¼ˆæŒ‰é’® + å®¹å™¨ï¼‰

### UML ç±»å›¾

```mermaid
classDiagram
    class Component {
        <<abstract>>
        +operation()
        +add(Component)
        +remove(Component)
        +getChild(int) Component
    }
    
    class Leaf {
        +operation()
    }
    
    class Composite {
        -children: List~Component~
        +operation()
        +add(Component)
        +remove(Component)
        +getChild(int) Component
    }
    
    Component <|-- Leaf
    Component <|-- Composite
    Composite o-- Component : contains
```

---

## 4.2 ç»„åˆæ¨¡å¼å®ç°ï¼ˆæ–‡ä»¶ç³»ç»Ÿç¤ºä¾‹ï¼‰

```java
// ===== æŠ½è±¡ç»„ä»¶ =====
public abstract class FileSystemNode {
    protected String name;
    
    public FileSystemNode(String name) {
        this.name = name;
    }
    
    // å…¬å…±æ–¹æ³•
    public abstract void display(int depth);
    
    // ç»„åˆèŠ‚ç‚¹çš„æ–¹æ³•ï¼ˆå¶å­èŠ‚ç‚¹å¯ä»¥æŠ›å‡ºå¼‚å¸¸æˆ–ç©ºå®ç°ï¼‰
    public void add(FileSystemNode node) {
        throw new UnsupportedOperationException("å¶å­èŠ‚ç‚¹ä¸æ”¯æŒæ·»åŠ ");
    }
    
    public void remove(FileSystemNode node) {
        throw new UnsupportedOperationException("å¶å­èŠ‚ç‚¹ä¸æ”¯æŒåˆ é™¤");
    }
    
    public FileSystemNode getChild(int index) {
        throw new UnsupportedOperationException("å¶å­èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹");
    }
}

// ===== å¶å­èŠ‚ç‚¹ï¼ˆæ–‡ä»¶ï¼‰ =====
public class File extends FileSystemNode {
    private long size;
    
    public File(String name, long size) {
        super(name);
        this.size = size;
    }
    
    @Override
    public void display(int depth) {
        String indent = "  ".repeat(depth);
        System.out.println(indent + "ğŸ“„ " + name + " (" + size + " bytes)");
    }
}

// ===== ç»„åˆèŠ‚ç‚¹ï¼ˆæ–‡ä»¶å¤¹ï¼‰ =====
public class Directory extends FileSystemNode {
    private List<FileSystemNode> children = new ArrayList<>();
    
    public Directory(String name) {
        super(name);
    }
    
    @Override
    public void display(int depth) {
        String indent = "  ".repeat(depth);
        System.out.println(indent + "ğŸ“ " + name);
        // é€’å½’æ˜¾ç¤ºå­èŠ‚ç‚¹
        for (FileSystemNode child : children) {
            child.display(depth + 1);
        }
    }
    
    @Override
    public void add(FileSystemNode node) {
        children.add(node);
    }
    
    @Override
    public void remove(FileSystemNode node) {
        children.remove(node);
    }
    
    @Override
    public FileSystemNode getChild(int index) {
        return children.get(index);
    }
}

// ===== ä½¿ç”¨ =====
public class Client {
    public static void main(String[] args) {
        // æ„å»ºæ–‡ä»¶æ ‘
        Directory root = new Directory("æ ¹ç›®å½•");
        
        Directory dir1 = new Directory("æ–‡æ¡£");
        dir1.add(new File("readme.txt", 1024));
        dir1.add(new File("notes.txt", 2048));
        
        Directory dir2 = new Directory("å›¾ç‰‡");
        dir2.add(new File("photo1.jpg", 512000));
        dir2.add(new File("photo2.jpg", 768000));
        
        root.add(dir1);
        root.add(dir2);
        root.add(new File("config.ini", 512));
        
        // ç»Ÿä¸€æ–¹å¼æ˜¾ç¤ºï¼ˆå®¢æˆ·ç«¯ä¸éœ€è¦åŒºåˆ†æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼‰
        root.display(0);
    }
}

// è¾“å‡ºï¼š
// ğŸ“ æ ¹ç›®å½•
//   ğŸ“ æ–‡æ¡£
//     ğŸ“„ readme.txt (1024 bytes)
//     ğŸ“„ notes.txt (2048 bytes)
//   ğŸ“ å›¾ç‰‡
//     ğŸ“„ photo1.jpg (512000 bytes)
//     ğŸ“„ photo2.jpg (768000 bytes)
//   ğŸ“„ config.ini (512 bytes)
```

---

## 4.3 ç»„åˆæ¨¡å¼çš„é€æ˜å¼ vs å®‰å…¨å¼

### é€æ˜å¼ï¼ˆä¸Šé¢çš„ä¾‹å­ï¼‰

- **ç‰¹ç‚¹**ï¼šComponent å®šä¹‰äº†æ‰€æœ‰æ–¹æ³•ï¼ˆåŒ…æ‹¬ addã€removeï¼‰
- **ä¼˜ç‚¹**ï¼šå®¢æˆ·ç«¯å¯ä»¥ç»Ÿä¸€å¤„ç†ï¼Œä¸éœ€è¦åˆ¤æ–­æ˜¯å¶å­è¿˜æ˜¯ç»„åˆ
- **ç¼ºç‚¹**ï¼šå¶å­èŠ‚ç‚¹éœ€è¦å®ç°ä¸éœ€è¦çš„æ–¹æ³•ï¼ˆæŠ›å‡ºå¼‚å¸¸æˆ–ç©ºå®ç°ï¼‰

### å®‰å…¨å¼

```java
// å®‰å…¨å¼ï¼šComponent åªå®šä¹‰å…¬å…±æ–¹æ³•ï¼Œç»„åˆæ–¹æ³•æ”¾åœ¨ Composite ä¸­
public abstract class Component {
    public abstract void operation();
    // ä¸å®šä¹‰ addã€remove æ–¹æ³•
}

public class Composite extends Component {
    private List<Component> children = new ArrayList<>();
    
    public void add(Component c) { children.add(c); }
    public void remove(Component c) { children.remove(c); }
    
    @Override
    public void operation() {
        for (Component child : children) {
            child.operation();
        }
    }
}

public class Leaf extends Component {
    @Override
    public void operation() {
        // å¶å­èŠ‚ç‚¹çš„æ“ä½œ
    }
    // ä¸éœ€è¦å®ç° addã€remove
}
```

- **ä¼˜ç‚¹**ï¼šå¶å­èŠ‚ç‚¹ä¸éœ€è¦å®ç°ä¸éœ€è¦çš„æ–¹æ³•
- **ç¼ºç‚¹**ï¼šå®¢æˆ·ç«¯éœ€è¦åˆ¤æ–­æ˜¯å¶å­è¿˜æ˜¯ç»„åˆï¼Œæ‰èƒ½è°ƒç”¨ addã€remove

---

## 4.4 å®é™…åº”ç”¨

### JDK ä¸­çš„åº”ç”¨

```java
// java.awt.Container å’Œ Component å°±æ˜¯ç»„åˆæ¨¡å¼
Container panel = new JPanel();
panel.add(new JButton("æŒ‰é’®1")); // æ·»åŠ ç»„ä»¶
panel.add(new JLabel("æ ‡ç­¾1"));  // æ·»åŠ ç»„ä»¶
// Container å’Œ Component éƒ½æ˜¯ Component çš„å­ç±»
```

### Spring ä¸­çš„åº”ç”¨

```java
// Spring çš„ BeanDefinition å¯ä»¥åŒ…å«å­ BeanDefinition
// å½¢æˆæ ‘å½¢ç»“æ„
```

---

# äº”ã€è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰

## 5.1 ä»€ä¹ˆæ˜¯è£…é¥°å™¨æ¨¡å¼

> **å®šä¹‰**ï¼šåŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ã€‚å°±å¢åŠ åŠŸèƒ½æ¥è¯´ï¼Œè£…é¥°å™¨æ¨¡å¼æ¯”ç”Ÿæˆå­ç±»æ›´ä¸ºçµæ´»ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼š**åŒ…è£…å™¨æ¨¡å¼**ï¼Œé€šè¿‡ç»„åˆçš„æ–¹å¼åŠ¨æ€æ‰©å±•åŠŸèƒ½ï¼Œé¿å…ç±»çˆ†ç‚¸ã€‚

### è£…é¥°å™¨æ¨¡å¼ vs ç»§æ‰¿

```java
// âŒ ç»§æ‰¿æ–¹å¼ï¼šç±»çˆ†ç‚¸
class Coffee { }
class MilkCoffee extends Coffee { }
class SugarCoffee extends Coffee { }
class MilkSugarCoffee extends Coffee { } // éœ€è¦ä¸ºæ¯ç§ç»„åˆåˆ›å»ºç±»
// å¦‚æœæœ‰ 3 ç§è°ƒæ–™ï¼Œéœ€è¦ 2^3 = 8 ä¸ªç±»

// âœ… è£…é¥°å™¨æ–¹å¼ï¼šåŠ¨æ€ç»„åˆ
class Coffee { }
class MilkDecorator extends CoffeeDecorator { } // è£…é¥°å™¨
class SugarDecorator extends CoffeeDecorator { } // è£…é¥°å™¨
// å¯ä»¥ä»»æ„ç»„åˆï¼Œä¸éœ€è¦ä¸ºæ¯ç§ç»„åˆåˆ›å»ºç±»
```

### UML ç±»å›¾

```mermaid
classDiagram
    class Component {
        <<interface>>
        +operation()
    }
    
    class ConcreteComponent {
        +operation()
    }
    
    class Decorator {
        -component: Component
        +operation()
    }
    
    class ConcreteDecoratorA {
        +operation()
        +addedBehavior()
    }
    
    class ConcreteDecoratorB {
        +operation()
        +addedBehavior()
    }
    
    Component <|.. ConcreteComponent
    Component <|.. Decorator
    Decorator <|-- ConcreteDecoratorA
    Decorator <|-- ConcreteDecoratorB
    Decorator o-- Component
```

---

## 5.2 è£…é¥°å™¨æ¨¡å¼å®ç°ï¼ˆå’–å•¡åŠ æ–™ç¤ºä¾‹ï¼‰

```java
// ===== æŠ½è±¡ç»„ä»¶ =====
public interface Coffee {
    String getDescription();
    double getCost();
}

// ===== å…·ä½“ç»„ä»¶ =====
public class SimpleCoffee implements Coffee {
    @Override
    public String getDescription() {
        return "æ™®é€šå’–å•¡";
    }
    
    @Override
    public double getCost() {
        return 5.0;
    }
}

// ===== æŠ½è±¡è£…é¥°å™¨ =====
public abstract class CoffeeDecorator implements Coffee {
    protected Coffee coffee; // è¢«è£…é¥°çš„å¯¹è±¡
    
    public CoffeeDecorator(Coffee coffee) {
        this.coffee = coffee;
    }
    
    @Override
    public String getDescription() {
        return coffee.getDescription();
    }
    
    @Override
    public double getCost() {
        return coffee.getCost();
    }
}

// ===== å…·ä½“è£…é¥°å™¨ =====
public class MilkDecorator extends CoffeeDecorator {
    public MilkDecorator(Coffee coffee) {
        super(coffee);
    }
    
    @Override
    public String getDescription() {
        return coffee.getDescription() + " + ç‰›å¥¶";
    }
    
    @Override
    public double getCost() {
        return coffee.getCost() + 2.0;
    }
}

public class SugarDecorator extends CoffeeDecorator {
    public SugarDecorator(Coffee coffee) {
        super(coffee);
    }
    
    @Override
    public String getDescription() {
        return coffee.getDescription() + " + ç³–";
    }
    
    @Override
    public double getCost() {
        return coffee.getCost() + 1.0;
    }
}

public class WhipDecorator extends CoffeeDecorator {
    public WhipDecorator(Coffee coffee) {
        super(coffee);
    }
    
    @Override
    public String getDescription() {
        return coffee.getDescription() + " + å¥¶æ²¹";
    }
    
    @Override
    public double getCost() {
        return coffee.getCost() + 3.0;
    }
}

// ===== ä½¿ç”¨ =====
public class Client {
    public static void main(String[] args) {
        // æ™®é€šå’–å•¡
        Coffee coffee = new SimpleCoffee();
        System.out.println(coffee.getDescription() + " = Â¥" + coffee.getCost());
        // è¾“å‡ºï¼šæ™®é€šå’–å•¡ = Â¥5.0
        
        // åŠ ç‰›å¥¶
        coffee = new MilkDecorator(coffee);
        System.out.println(coffee.getDescription() + " = Â¥" + coffee.getCost());
        // è¾“å‡ºï¼šæ™®é€šå’–å•¡ + ç‰›å¥¶ = Â¥7.0
        
        // å†åŠ ç³–
        coffee = new SugarDecorator(coffee);
        System.out.println(coffee.getDescription() + " = Â¥" + coffee.getCost());
        // è¾“å‡ºï¼šæ™®é€šå’–å•¡ + ç‰›å¥¶ + ç³– = Â¥8.0
        
        // å†åŠ å¥¶æ²¹
        coffee = new WhipDecorator(coffee);
        System.out.println(coffee.getDescription() + " = Â¥" + coffee.getCost());
        // è¾“å‡ºï¼šæ™®é€šå’–å•¡ + ç‰›å¥¶ + ç³– + å¥¶æ²¹ = Â¥11.0
        
        // å¯ä»¥ä»»æ„ç»„åˆï¼Œä¸éœ€è¦ä¸ºæ¯ç§ç»„åˆåˆ›å»ºç±»
    }
}
```

---

## 5.3 è£…é¥°å™¨æ¨¡å¼ vs ä»£ç†æ¨¡å¼

| ç»´åº¦ | è£…é¥°å™¨æ¨¡å¼ | ä»£ç†æ¨¡å¼ |
|------|-----------|---------|
| **ç›®çš„** | å¢å¼ºåŠŸèƒ½ | æ§åˆ¶è®¿é—® |
| **å…³æ³¨ç‚¹** | åŠŸèƒ½æ‰©å±• | è®¿é—®æ§åˆ¶ã€å»¶è¿ŸåŠ è½½ |
| **å…³ç³»** | è£…é¥°å™¨å’Œè¢«è£…é¥°è€…å¯ä»¥ç‹¬ç«‹å˜åŒ– | ä»£ç†å’Œè¢«ä»£ç†è€…é€šå¸¸æœ‰å›ºå®šå…³ç³» |
| **ä½¿ç”¨åœºæ™¯** | åŠ¨æ€æ·»åŠ åŠŸèƒ½ | å»¶è¿ŸåŠ è½½ã€æƒé™æ§åˆ¶ã€æ—¥å¿—è®°å½• |

---

## 5.4 å®é™…åº”ç”¨

### JDK ä¸­çš„åº”ç”¨

```java
// java.io åŒ…ä¸­çš„è£…é¥°å™¨æ¨¡å¼
// InputStream æ˜¯æŠ½è±¡ç»„ä»¶
// FileInputStream æ˜¯å…·ä½“ç»„ä»¶
// BufferedInputStreamã€DataInputStream æ˜¯è£…é¥°å™¨

InputStream is = new FileInputStream("file.txt");
is = new BufferedInputStream(is); // è£…é¥°ï¼šæ·»åŠ ç¼“å†²åŠŸèƒ½
is = new DataInputStream(is);      // è£…é¥°ï¼šæ·»åŠ æ•°æ®è¯»å–åŠŸèƒ½
```

### Spring ä¸­çš„åº”ç”¨

```java
// Spring AOP ä¸­çš„è£…é¥°å™¨æ¨¡å¼
// é€šè¿‡ä»£ç†ï¼ˆè£…é¥°å™¨ï¼‰ä¸º Bean æ·»åŠ æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆæ—¥å¿—ã€äº‹åŠ¡ç­‰ï¼‰
@Transactional
public class UserService {
    // äº‹åŠ¡åŠŸèƒ½é€šè¿‡è£…é¥°å™¨ï¼ˆä»£ç†ï¼‰æ·»åŠ 
}
```

---

# å…­ã€å¤–è§‚æ¨¡å¼ï¼ˆFacadeï¼‰

## 6.1 ä»€ä¹ˆæ˜¯å¤–è§‚æ¨¡å¼

> **å®šä¹‰**ï¼šä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ã€‚å¤–è§‚æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä½¿å¾—è¿™ä¸€å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“ä½¿ç”¨ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼š**ç®€åŒ–æ¥å£**ï¼Œéšè—å­ç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œæä¾›ä¸€ä¸ªç®€å•çš„æ¥å£ç»™å®¢æˆ·ç«¯ã€‚

### ç”Ÿæ´»ä¸­çš„ä¾‹å­

- **é¥æ§å™¨**ï¼šä¸€ä¸ªé¥æ§å™¨æ§åˆ¶ç”µè§†ã€éŸ³å“ã€ç©ºè°ƒç­‰å¤šä¸ªè®¾å¤‡
- **ä¸€é”®å¯åŠ¨**ï¼šæ±½è½¦çš„ä¸€é”®å¯åŠ¨æŒ‰é’®ï¼ŒèƒŒåæ¶‰åŠå¤šä¸ªç³»ç»Ÿï¼ˆå‘åŠ¨æœºã€ç”µç“¶ã€æ²¹è·¯ç­‰ï¼‰

### UML ç±»å›¾

```mermaid
classDiagram
    class Facade {
        -subsystemA: SubsystemA
        -subsystemB: SubsystemB
        -subsystemC: SubsystemC
        +operation()
    }
    
    class SubsystemA {
        +operationA()
    }
    
    class SubsystemB {
        +operationB()
    }
    
    class SubsystemC {
        +operationC()
    }
    
    class Client {
        +useFacade()
    }
    
    Facade o-- SubsystemA
    Facade o-- SubsystemB
    Facade o-- SubsystemC
    Client ..> Facade : uses
    Client ..x SubsystemA : ä¸ç›´æ¥ä½¿ç”¨
    Client ..x SubsystemB : ä¸ç›´æ¥ä½¿ç”¨
    Client ..x SubsystemC : ä¸ç›´æ¥ä½¿ç”¨
```

---

## 6.2 å¤–è§‚æ¨¡å¼å®ç°ï¼ˆå®¶åº­å½±é™¢ç³»ç»Ÿï¼‰

```java
// ===== å­ç³»ç»Ÿç»„ä»¶ =====
public class DVDPlayer {
    public void on() { System.out.println("DVD æ’­æ”¾å™¨æ‰“å¼€"); }
    public void off() { System.out.println("DVD æ’­æ”¾å™¨å…³é—­"); }
    public void play(String movie) { System.out.println("æ’­æ”¾ç”µå½±: " + movie); }
    public void stop() { System.out.println("åœæ­¢æ’­æ”¾"); }
}

public class Projector {
    public void on() { System.out.println("æŠ•å½±ä»ªæ‰“å¼€"); }
    public void off() { System.out.println("æŠ•å½±ä»ªå…³é—­"); }
    public void wideScreenMode() { System.out.println("æŠ•å½±ä»ªè®¾ç½®ä¸ºå®½å±æ¨¡å¼"); }
}

public class SoundSystem {
    public void on() { System.out.println("éŸ³å“ç³»ç»Ÿæ‰“å¼€"); }
    public void off() { System.out.println("éŸ³å“ç³»ç»Ÿå…³é—­"); }
    public void setVolume(int level) { System.out.println("éŸ³é‡è®¾ç½®ä¸º: " + level); }
}

public class TheaterLights {
    public void on() { System.out.println("ç¯å…‰æ‰“å¼€"); }
    public void off() { System.out.println("ç¯å…‰å…³é—­"); }
    public void dim(int level) { System.out.println("ç¯å…‰è°ƒæš—åˆ°: " + level + "%"); }
}

// ===== å¤–è§‚ç±»ï¼ˆç®€åŒ–æ¥å£ï¼‰ =====
public class HomeTheaterFacade {
    private DVDPlayer dvdPlayer;
    private Projector projector;
    private SoundSystem soundSystem;
    private TheaterLights lights;
    
    public HomeTheaterFacade(DVDPlayer dvd, Projector proj, 
                             SoundSystem sound, TheaterLights lights) {
        this.dvdPlayer = dvd;
        this.projector = proj;
        this.soundSystem = sound;
        this.lights = lights;
    }
    
    // ä¸€é”®çœ‹ç”µå½±ï¼ˆç®€åŒ–äº†å¤æ‚çš„æ“ä½œæµç¨‹ï¼‰
    public void watchMovie(String movie) {
        System.out.println("========== å‡†å¤‡çœ‹ç”µå½± ==========");
        lights.dim(10);              // è°ƒæš—ç¯å…‰
        projector.on();              // æ‰“å¼€æŠ•å½±ä»ª
        projector.wideScreenMode();  // è®¾ç½®å®½å±
        soundSystem.on();            // æ‰“å¼€éŸ³å“
        soundSystem.setVolume(5);    // è®¾ç½®éŸ³é‡
        dvdPlayer.on();              // æ‰“å¼€ DVD
        dvdPlayer.play(movie);       // æ’­æ”¾ç”µå½±
        System.out.println("========== å¼€å§‹è§‚çœ‹ ==========");
    }
    
    // ä¸€é”®ç»“æŸ
    public void endMovie() {
        System.out.println("========== ç»“æŸè§‚çœ‹ ==========");
        dvdPlayer.stop();
        dvdPlayer.off();
        soundSystem.off();
        projector.off();
        lights.on();
        System.out.println("========== å·²å…³é—­æ‰€æœ‰è®¾å¤‡ ==========");
    }
}

// ===== ä½¿ç”¨ =====
public class Client {
    public static void main(String[] args) {
        // åˆ›å»ºå­ç³»ç»Ÿç»„ä»¶
        DVDPlayer dvd = new DVDPlayer();
        Projector projector = new Projector();
        SoundSystem sound = new SoundSystem();
        TheaterLights lights = new TheaterLights();
        
        // åˆ›å»ºå¤–è§‚
        HomeTheaterFacade facade = new HomeTheaterFacade(dvd, projector, sound, lights);
        
        // å®¢æˆ·ç«¯åªéœ€è¦è°ƒç”¨ç®€å•çš„æ–¹æ³•
        facade.watchMovie("å¤ä»‡è€…è”ç›Ÿ");
        // è¾“å‡ºï¼š
        // ========== å‡†å¤‡çœ‹ç”µå½± ==========
        // ç¯å…‰è°ƒæš—åˆ°: 10%
        // æŠ•å½±ä»ªæ‰“å¼€
        // æŠ•å½±ä»ªè®¾ç½®ä¸ºå®½å±æ¨¡å¼
        // éŸ³å“ç³»ç»Ÿæ‰“å¼€
        // éŸ³é‡è®¾ç½®ä¸º: 5
        // DVD æ’­æ”¾å™¨æ‰“å¼€
        // æ’­æ”¾ç”µå½±: å¤ä»‡è€…è”ç›Ÿ
        // ========== å¼€å§‹è§‚çœ‹ ==========
        
        facade.endMovie();
    }
}
```

---

## 6.3 å¤–è§‚æ¨¡å¼ vs é€‚é…å™¨æ¨¡å¼

| ç»´åº¦ | å¤–è§‚æ¨¡å¼ | é€‚é…å™¨æ¨¡å¼ |
|------|---------|-----------|
| **ç›®çš„** | ç®€åŒ–æ¥å£ | è½¬æ¢æ¥å£ |
| **å…³æ³¨ç‚¹** | éšè—å¤æ‚æ€§ | æ¥å£å…¼å®¹ |
| **å…³ç³»** | å¤–è§‚æ˜¯å­ç³»ç»Ÿçš„ç®€åŒ–æ¥å£ | é€‚é…å™¨æ˜¯æ¥å£è½¬æ¢å™¨ |
| **ä½¿ç”¨åœºæ™¯** | ä¸ºå¤æ‚å­ç³»ç»Ÿæä¾›ç®€å•æ¥å£ | è®©ä¸å…¼å®¹çš„æ¥å£ååŒå·¥ä½œ |

---

## 6.4 å®é™…åº”ç”¨

### JDK ä¸­çš„åº”ç”¨

```java
// java.net.URL æ˜¯å¤–è§‚æ¨¡å¼
// å®ƒå°è£…äº† URLConnectionã€URLStreamHandler ç­‰å¤æ‚å­ç³»ç»Ÿ
URL url = new URL("https://www.example.com");
URLConnection conn = url.openConnection(); // ç®€åŒ–äº†å¤æ‚çš„è¿æ¥è¿‡ç¨‹
```

### Spring ä¸­çš„åº”ç”¨

```java
// Spring çš„ JdbcTemplate æ˜¯å¤–è§‚æ¨¡å¼
// å®ƒå°è£…äº† Connectionã€Statementã€ResultSet ç­‰ JDBC å¤æ‚æ“ä½œ
JdbcTemplate jdbcTemplate = new JdbcTemplate(dataSource);
jdbcTemplate.query("SELECT * FROM users", rowMapper); // ç®€åŒ–äº† JDBC æ“ä½œ
```

---

# ä¸ƒã€äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰

## 7.1 ä»€ä¹ˆæ˜¯äº«å…ƒæ¨¡å¼

> **å®šä¹‰**ï¼šè¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼š**å…±äº«å†…éƒ¨çŠ¶æ€ï¼Œåˆ†ç¦»å¤–éƒ¨çŠ¶æ€**ï¼Œå‡å°‘å¯¹è±¡æ•°é‡ï¼ŒèŠ‚çœå†…å­˜ã€‚

### é€‚ç”¨åœºæ™¯

- ç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡ç›¸ä¼¼å¯¹è±¡
- è¿™äº›å¯¹è±¡çš„å¤§éƒ¨åˆ†çŠ¶æ€å¯ä»¥å…±äº«
- éœ€è¦ç¼“å†²æ± çš„åœºæ™¯ï¼ˆå¦‚çº¿ç¨‹æ± ã€è¿æ¥æ± ï¼‰

### UML ç±»å›¾

```mermaid
classDiagram
    class Flyweight {
        <<interface>>
        +operation(extrinsicState)
    }
    
    class ConcreteFlyweight {
        -intrinsicState
        +operation(extrinsicState)
    }
    
    class UnsharedConcreteFlyweight {
        -allState
        +operation(extrinsicState)
    }
    
    class FlyweightFactory {
        -flyweights: Map
        +getFlyweight(key) Flyweight
    }
    
    class Client {
        +useFlyweight()
    }
    
    Flyweight <|.. ConcreteFlyweight
    Flyweight <|.. UnsharedConcreteFlyweight
    FlyweightFactory ..> Flyweight : creates
    Client ..> FlyweightFactory : uses
    Client ..> Flyweight : uses
```

---

## 7.2 äº«å…ƒæ¨¡å¼å®ç°ï¼ˆå›´æ£‹æ£‹å­ç¤ºä¾‹ï¼‰

å›´æ£‹æœ‰ 361 ä¸ªä½ç½®ï¼Œå¦‚æœæ¯ä¸ªä½ç½®éƒ½åˆ›å»ºä¸€ä¸ªæ£‹å­å¯¹è±¡ï¼Œä¼šåˆ›å»ºå¤§é‡å¯¹è±¡ã€‚ä½†æ£‹å­åªæœ‰ä¸¤ç§ï¼šé»‘æ£‹å’Œç™½æ£‹ï¼Œå¯ä»¥å…±äº«ã€‚

```java
// ===== äº«å…ƒæ¥å£ =====
public interface ChessPiece {
    void place(int x, int y); // x, y æ˜¯å¤–éƒ¨çŠ¶æ€ï¼ˆä½ç½®ï¼‰
}

// ===== å…·ä½“äº«å…ƒï¼ˆå…±äº«å†…éƒ¨çŠ¶æ€ï¼šé¢œè‰²ï¼‰ =====
public class BlackChessPiece implements ChessPiece {
    private final String color = "é»‘è‰²"; // å†…éƒ¨çŠ¶æ€ï¼ˆå…±äº«ï¼‰
    
    @Override
    public void place(int x, int y) {
        System.out.println(color + "æ£‹å­æ”¾åœ¨ (" + x + ", " + y + ")");
    }
}

public class WhiteChessPiece implements ChessPiece {
    private final String color = "ç™½è‰²"; // å†…éƒ¨çŠ¶æ€ï¼ˆå…±äº«ï¼‰
    
    @Override
    public void place(int x, int y) {
        System.out.println(color + "æ£‹å­æ”¾åœ¨ (" + x + ", " + y + ")");
    }
}

// ===== äº«å…ƒå·¥å‚ =====
public class ChessPieceFactory {
    private static final Map<String, ChessPiece> pieces = new HashMap<>();
    
    public static ChessPiece getChessPiece(String color) {
        ChessPiece piece = pieces.get(color);
        if (piece == null) {
            if ("é»‘è‰²".equals(color)) {
                piece = new BlackChessPiece();
            } else if ("ç™½è‰²".equals(color)) {
                piece = new WhiteChessPiece();
            }
            pieces.put(color, piece);
            System.out.println("åˆ›å»º " + color + " æ£‹å­ï¼ˆäº«å…ƒå¯¹è±¡ï¼‰");
        }
        return piece;
    }
    
    public static int getPieceCount() {
        return pieces.size();
    }
}

// ===== ä½¿ç”¨ =====
public class Client {
    public static void main(String[] args) {
        // ä¸‹ 10 ä¸ªé»‘æ£‹
        for (int i = 0; i < 10; i++) {
            ChessPiece black = ChessPieceFactory.getChessPiece("é»‘è‰²");
            black.place(i, i);
        }
        
        // ä¸‹ 10 ä¸ªç™½æ£‹
        for (int i = 0; i < 10; i++) {
            ChessPiece white = ChessPieceFactory.getChessPiece("ç™½è‰²");
            white.place(i, 10 - i);
        }
        
        System.out.println("æ€»å…±åˆ›å»ºçš„æ£‹å­å¯¹è±¡æ•°: " + ChessPieceFactory.getPieceCount());
        // è¾“å‡ºï¼šæ€»å…±åˆ›å»ºçš„æ£‹å­å¯¹è±¡æ•°: 2ï¼ˆåªæœ‰ 2 ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯ 20 ä¸ªï¼‰
    }
}
```

---

## 7.3 å†…éƒ¨çŠ¶æ€ vs å¤–éƒ¨çŠ¶æ€

| çŠ¶æ€ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|---------|------|------|
| **å†…éƒ¨çŠ¶æ€ï¼ˆIntrinsic Stateï¼‰** | å¯ä»¥å…±äº«çš„çŠ¶æ€ï¼Œå­˜å‚¨åœ¨äº«å…ƒå¯¹è±¡å†…éƒ¨ | æ£‹å­çš„é¢œè‰²ã€å­—ç¬¦çš„å­—ä½“ |
| **å¤–éƒ¨çŠ¶æ€ï¼ˆExtrinsic Stateï¼‰** | ä¸èƒ½å…±äº«çš„çŠ¶æ€ï¼Œç”±å®¢æˆ·ç«¯ä¼ å…¥ | æ£‹å­çš„ä½ç½®ã€å­—ç¬¦çš„ä½ç½® |

---

## 7.4 å®é™…åº”ç”¨

### JDK ä¸­çš„åº”ç”¨

```java
// String å¸¸é‡æ± å°±æ˜¯äº«å…ƒæ¨¡å¼
String s1 = "hello";
String s2 = "hello";
System.out.println(s1 == s2); // trueï¼ˆå…±äº«åŒä¸€ä¸ªå¯¹è±¡ï¼‰

// Integer ç¼“å­˜ï¼ˆ-128 åˆ° 127ï¼‰
Integer i1 = 127;
Integer i2 = 127;
System.out.println(i1 == i2); // trueï¼ˆå…±äº«ï¼‰

Integer i3 = 128;
Integer i4 = 128;
System.out.println(i3 == i4); // falseï¼ˆè¶…å‡ºç¼“å­˜èŒƒå›´ï¼‰
```

### å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨

```java
// çº¿ç¨‹æ± å°±æ˜¯äº«å…ƒæ¨¡å¼
// çº¿ç¨‹å¯¹è±¡å¯ä»¥å¤ç”¨ï¼ˆå…±äº«ï¼‰ï¼Œä»»åŠ¡å‚æ•°æ˜¯å¤–éƒ¨çŠ¶æ€
ExecutorService executor = Executors.newFixedThreadPool(10);
for (int i = 0; i < 100; i++) {
    final int taskId = i; // å¤–éƒ¨çŠ¶æ€
    executor.submit(() -> {
        System.out.println("æ‰§è¡Œä»»åŠ¡: " + taskId);
    });
}
// åªåˆ›å»ºäº† 10 ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œè€Œä¸æ˜¯ 100 ä¸ª
```

---

# å…«ã€ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰

## 8.1 ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼

> **å®šä¹‰**ï¼šä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼š**æ§åˆ¶è®¿é—®**ï¼Œåœ¨è®¿é—®å¯¹è±¡æ—¶å¼•å…¥ä¸€å®šç¨‹åº¦çš„é—´æ¥æ€§ã€‚

### ä»£ç†æ¨¡å¼çš„ä¸‰ç§ç±»å‹

1. **é™æ€ä»£ç†**ï¼šä»£ç†ç±»åœ¨ç¼–è¯‘æ—¶ç¡®å®š
2. **åŠ¨æ€ä»£ç†**ï¼šä»£ç†ç±»åœ¨è¿è¡Œæ—¶ç”Ÿæˆï¼ˆJDK åŠ¨æ€ä»£ç†ã€CGLIBï¼‰
3. **è™šæ‹Ÿä»£ç†**ï¼šå»¶è¿ŸåŠ è½½ï¼ˆLazy Loadingï¼‰

### UML ç±»å›¾

```mermaid
classDiagram
    class Subject {
        <<interface>>
        +request()
    }
    
    class RealSubject {
        +request()
    }
    
    class Proxy {
        -realSubject: RealSubject
        +request()
        -preRequest()
        -postRequest()
    }
    
    class Client {
        +useSubject()
    }
    
    Subject <|.. RealSubject
    Subject <|.. Proxy
    Proxy o-- RealSubject
    Client ..> Subject : uses
```

---

## 8.2 é™æ€ä»£ç†

```java
// ===== æ¥å£ =====
public interface UserService {
    void saveUser(User user);
    void deleteUser(Long id);
}

// ===== çœŸå®å¯¹è±¡ =====
public class UserServiceImpl implements UserService {
    @Override
    public void saveUser(User user) {
        System.out.println("ä¿å­˜ç”¨æˆ·: " + user.getName());
        // å®é™…çš„ä¿å­˜é€»è¾‘
    }
    
    @Override
    public void deleteUser(Long id) {
        System.out.println("åˆ é™¤ç”¨æˆ·: " + id);
        // å®é™…çš„åˆ é™¤é€»è¾‘
    }
}

// ===== ä»£ç†å¯¹è±¡ =====
public class UserServiceProxy implements UserService {
    private UserService target; // è¢«ä»£ç†çš„å¯¹è±¡
    
    public UserServiceProxy(UserService target) {
        this.target = target;
    }
    
    @Override
    public void saveUser(User user) {
        System.out.println("ã€ä»£ç†ã€‘å¼€å§‹ä¿å­˜ç”¨æˆ·...");
        long start = System.currentTimeMillis();
        
        target.saveUser(user); // è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•
        
        long end = System.currentTimeMillis();
        System.out.println("ã€ä»£ç†ã€‘ä¿å­˜ç”¨æˆ·å®Œæˆï¼Œè€—æ—¶: " + (end - start) + "ms");
    }
    
    @Override
    public void deleteUser(Long id) {
        System.out.println("ã€ä»£ç†ã€‘å¼€å§‹åˆ é™¤ç”¨æˆ·...");
        long start = System.currentTimeMillis();
        
        target.deleteUser(id); // è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•
        
        long end = System.currentTimeMillis();
        System.out.println("ã€ä»£ç†ã€‘åˆ é™¤ç”¨æˆ·å®Œæˆï¼Œè€—æ—¶: " + (end - start) + "ms");
    }
}

// ===== ä½¿ç”¨ =====
public class Client {
    public static void main(String[] args) {
        UserService realService = new UserServiceImpl();
        UserService proxy = new UserServiceProxy(realService);
        
        proxy.saveUser(new User("å¼ ä¸‰"));
        // è¾“å‡ºï¼š
        // ã€ä»£ç†ã€‘å¼€å§‹ä¿å­˜ç”¨æˆ·...
        // ä¿å­˜ç”¨æˆ·: å¼ ä¸‰
        // ã€ä»£ç†ã€‘ä¿å­˜ç”¨æˆ·å®Œæˆï¼Œè€—æ—¶: 2ms
    }
}
```

**é™æ€ä»£ç†çš„ç¼ºç‚¹**ï¼š
- æ¯ä¸ªè¢«ä»£ç†ç±»éƒ½éœ€è¦ä¸€ä¸ªä»£ç†ç±»ï¼Œç±»æ•°é‡ç¿»å€
- å¦‚æœæ¥å£æ–¹æ³•å¾ˆå¤šï¼Œä»£ç†ç±»ä»£ç å†—ä½™

---

## 8.3 JDK åŠ¨æ€ä»£ç† â­â­â­

JDK åŠ¨æ€ä»£ç†é€šè¿‡ `Proxy` ç±»å’Œ `InvocationHandler` æ¥å£åœ¨è¿è¡Œæ—¶ç”Ÿæˆä»£ç†ç±»ï¼š

```java
// ===== æ¥å£ =====
public interface UserService {
    void saveUser(User user);
    void deleteUser(Long id);
}

// ===== çœŸå®å¯¹è±¡ =====
public class UserServiceImpl implements UserService {
    @Override
    public void saveUser(User user) {
        System.out.println("ä¿å­˜ç”¨æˆ·: " + user.getName());
    }
    
    @Override
    public void deleteUser(Long id) {
        System.out.println("åˆ é™¤ç”¨æˆ·: " + id);
    }
}

// ===== åŠ¨æ€ä»£ç†å¤„ç†å™¨ =====
public class LogInvocationHandler implements InvocationHandler {
    private Object target; // è¢«ä»£ç†çš„å¯¹è±¡
    
    public LogInvocationHandler(Object target) {
        this.target = target;
    }
    
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        System.out.println("ã€åŠ¨æ€ä»£ç†ã€‘è°ƒç”¨æ–¹æ³•: " + method.getName());
        long start = System.currentTimeMillis();
        
        // è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•
        Object result = method.invoke(target, args);
        
        long end = System.currentTimeMillis();
        System.out.println("ã€åŠ¨æ€ä»£ç†ã€‘æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶: " + (end - start) + "ms");
        return result;
    }
}

// ===== ä½¿ç”¨ =====
public class Client {
    public static void main(String[] args) {
        UserService realService = new UserServiceImpl();
        
        // åˆ›å»ºåŠ¨æ€ä»£ç†
        UserService proxy = (UserService) Proxy.newProxyInstance(
            realService.getClass().getClassLoader(),  // ç±»åŠ è½½å™¨
            realService.getClass().getInterfaces(),    // æ¥å£æ•°ç»„
            new LogInvocationHandler(realService)      // å¤„ç†å™¨
        );
        
        proxy.saveUser(new User("å¼ ä¸‰"));
        // è¾“å‡ºï¼š
        // ã€åŠ¨æ€ä»£ç†ã€‘è°ƒç”¨æ–¹æ³•: saveUser
        // ä¿å­˜ç”¨æˆ·: å¼ ä¸‰
        // ã€åŠ¨æ€ä»£ç†ã€‘æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶: 1ms
    }
}
```

**JDK åŠ¨æ€ä»£ç†åŸç†**ï¼š
1. åœ¨è¿è¡Œæ—¶é€šè¿‡ `Proxy.newProxyInstance()` ç”Ÿæˆä»£ç†ç±»
2. ä»£ç†ç±»å®ç°ç›®æ ‡æ¥å£ï¼Œæ‰€æœ‰æ–¹æ³•è°ƒç”¨éƒ½è½¬å‘åˆ° `InvocationHandler.invoke()`
3. ä»£ç†ç±»æ˜¯åœ¨å†…å­˜ä¸­åŠ¨æ€ç”Ÿæˆçš„ï¼Œä¸ä¼šç”Ÿæˆ `.class` æ–‡ä»¶

**JDK åŠ¨æ€ä»£ç†çš„é™åˆ¶**ï¼š
- åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»
- å¦‚æœç±»æ²¡æœ‰å®ç°æ¥å£ï¼Œæ— æ³•ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†

---

## 8.4 CGLIB åŠ¨æ€ä»£ç† â­â­â­

CGLIB é€šè¿‡**ç»§æ‰¿**ç›®æ ‡ç±»æ¥åˆ›å»ºä»£ç†ï¼Œä¸éœ€è¦æ¥å£ï¼š

```java
// ===== ç›®æ ‡ç±»ï¼ˆæ²¡æœ‰æ¥å£ï¼‰ =====
public class UserService {
    public void saveUser(User user) {
        System.out.println("ä¿å­˜ç”¨æˆ·: " + user.getName());
    }
    
    public void deleteUser(Long id) {
        System.out.println("åˆ é™¤ç”¨æˆ·: " + id);
    }
}

// ===== CGLIB æ–¹æ³•æ‹¦æˆªå™¨ =====
public class LogMethodInterceptor implements MethodInterceptor {
    @Override
    public Object intercept(Object obj, Method method, Object[] args, 
                           MethodProxy proxy) throws Throwable {
        System.out.println("ã€CGLIBä»£ç†ã€‘è°ƒç”¨æ–¹æ³•: " + method.getName());
        long start = System.currentTimeMillis();
        
        // è°ƒç”¨çˆ¶ç±»ï¼ˆç›®æ ‡ç±»ï¼‰çš„æ–¹æ³•
        Object result = proxy.invokeSuper(obj, args);
        
        long end = System.currentTimeMillis();
        System.out.println("ã€CGLIBä»£ç†ã€‘æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶: " + (end - start) + "ms");
        return result;
    }
}

// ===== ä½¿ç”¨ =====
public class Client {
    public static void main(String[] args) {
        // åˆ›å»º Enhancer
        Enhancer enhancer = new Enhancer();
        enhancer.setSuperclass(UserService.class); // è®¾ç½®çˆ¶ç±»
        enhancer.setCallback(new LogMethodInterceptor()); // è®¾ç½®å›è°ƒ
        
        // åˆ›å»ºä»£ç†å¯¹è±¡
        UserService proxy = (UserService) enhancer.create();
        
        proxy.saveUser(new User("å¼ ä¸‰"));
        // è¾“å‡ºï¼š
        // ã€CGLIBä»£ç†ã€‘è°ƒç”¨æ–¹æ³•: saveUser
        // ä¿å­˜ç”¨æˆ·: å¼ ä¸‰
        // ã€CGLIBä»£ç†ã€‘æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶: 1ms
    }
}
```

**CGLIB åŸç†**ï¼š
- é€šè¿‡ç»§æ‰¿ç›®æ ‡ç±»åˆ›å»ºå­ç±»
- å­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸­è°ƒç”¨ `MethodInterceptor.intercept()`
- éœ€è¦å¼•å…¥ CGLIB ä¾èµ–

**CGLIB çš„é™åˆ¶**ï¼š
- ä¸èƒ½ä»£ç† final ç±»å’Œæ–¹æ³•ï¼ˆå› ä¸ºéœ€è¦ç»§æ‰¿ï¼‰
- æ€§èƒ½ç•¥ä½äº JDK åŠ¨æ€ä»£ç†ï¼ˆä½†å·®è·å¾ˆå°ï¼‰

---

## 8.5 JDK åŠ¨æ€ä»£ç† vs CGLIB

| ç»´åº¦ | JDK åŠ¨æ€ä»£ç† | CGLIB |
|------|------------|-------|
| **å®ç°æ–¹å¼** | å®ç°æ¥å£ | ç»§æ‰¿ç±» |
| **è¦æ±‚** | ç›®æ ‡ç±»å¿…é¡»å®ç°æ¥å£ | ç›®æ ‡ç±»ä¸èƒ½æ˜¯ final |
| **æ€§èƒ½** | ç•¥å¿«ï¼ˆJDK 8+ ä¼˜åŒ–åï¼‰ | ç•¥æ…¢ï¼ˆä½†å·®è·å¾ˆå°ï¼‰ |
| **ä¾èµ–** | JDK è‡ªå¸¦ | éœ€è¦å¼•å…¥ CGLIB |
| **Spring é»˜è®¤** | æœ‰æ¥å£ç”¨ JDK | æ— æ¥å£ç”¨ CGLIB |

---

## 8.6 ä»£ç†æ¨¡å¼çš„åº”ç”¨åœºæ™¯

### 1. è¿œç¨‹ä»£ç†ï¼ˆRemote Proxyï¼‰

ä¸ºè¿œç¨‹å¯¹è±¡æä¾›æœ¬åœ°ä»£è¡¨ï¼š

```java
// RMIï¼ˆRemote Method Invocationï¼‰å°±æ˜¯è¿œç¨‹ä»£ç†
// å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹å¯¹è±¡å°±åƒè°ƒç”¨æœ¬åœ°å¯¹è±¡ä¸€æ ·
```

### 2. è™šæ‹Ÿä»£ç†ï¼ˆVirtual Proxyï¼‰

å»¶è¿ŸåŠ è½½å¤§å¯¹è±¡ï¼š

```java
public class ImageProxy implements Image {
    private String filename;
    private RealImage realImage; // å»¶è¿ŸåŠ è½½
    
    public ImageProxy(String filename) {
        this.filename = filename;
    }
    
    @Override
    public void display() {
        if (realImage == null) {
            realImage = new RealImage(filename); // çœŸæ­£éœ€è¦æ—¶æ‰åŠ è½½
        }
        realImage.display();
    }
}
```

### 3. ä¿æŠ¤ä»£ç†ï¼ˆProtection Proxyï¼‰

æ§åˆ¶å¯¹å¯¹è±¡çš„è®¿é—®æƒé™ï¼š

```java
public class ProtectionProxy implements UserService {
    private UserService target;
    private User currentUser;
    
    public ProtectionProxy(UserService target, User currentUser) {
        this.target = target;
        this.currentUser = currentUser;
    }
    
    @Override
    public void deleteUser(Long id) {
        if (!currentUser.isAdmin()) {
            throw new SecurityException("æ— æƒé™åˆ é™¤ç”¨æˆ·");
        }
        target.deleteUser(id);
    }
}
```

### 4. æ™ºèƒ½å¼•ç”¨ï¼ˆSmart Referenceï¼‰

åœ¨è®¿é—®å¯¹è±¡æ—¶æ‰§è¡Œé¢å¤–æ“ä½œï¼ˆå¦‚è®¡æ•°ã€æ—¥å¿—ï¼‰ï¼š

```java
// Spring AOP å°±æ˜¯æ™ºèƒ½å¼•ç”¨
// åœ¨æ–¹æ³•è°ƒç”¨å‰åæ‰§è¡Œæ—¥å¿—ã€äº‹åŠ¡ç­‰æ“ä½œ
```

---

## 8.7 å®é™…åº”ç”¨

### Spring AOP

Spring AOP ä½¿ç”¨ä»£ç†æ¨¡å¼å®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼š

```java
@Service
public class UserService {
    @Transactional
    public void saveUser(User user) {
        // ä¿å­˜ç”¨æˆ·
    }
}

// Spring ä¼šä¸º UserService åˆ›å»ºä»£ç†
// åœ¨ saveUser() è°ƒç”¨å‰åæ·»åŠ äº‹åŠ¡ç®¡ç†
```

**Spring AOP ä»£ç†é€‰æ‹©**ï¼š
- å¦‚æœ Bean å®ç°äº†æ¥å£ â†’ ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†
- å¦‚æœ Bean æ²¡æœ‰å®ç°æ¥å£ â†’ ä½¿ç”¨ CGLIB

### MyBatis

MyBatis çš„ Mapper æ¥å£å°±æ˜¯é€šè¿‡ JDK åŠ¨æ€ä»£ç†å®ç°çš„ï¼š

```java
// Mapper æ¥å£
public interface UserMapper {
    User selectById(Long id);
}

// MyBatis åœ¨è¿è¡Œæ—¶ä¸º Mapper æ¥å£åˆ›å»ºä»£ç†å¯¹è±¡
// ä»£ç†å¯¹è±¡å°†æ–¹æ³•è°ƒç”¨è½¬æ¢ä¸º SQL æ‰§è¡Œ
```

---

# ä¹ã€ç»“æ„å‹æ¨¡å¼åœ¨ Spring/JDK ä¸­çš„åº”ç”¨æ€»ç»“

| æ¨¡å¼ | JDK ä¸­çš„åº”ç”¨ | Spring ä¸­çš„åº”ç”¨ |
|------|-------------|----------------|
| **é€‚é…å™¨** | `InputStreamReader`ã€`Arrays.asList()` | `HandlerAdapter`ï¼ˆMVCï¼‰ |
| **æ¡¥æ¥** | JDBC `DriverManager` | `DataSource` æ¡¥æ¥ä¸åŒå®ç° |
| **ç»„åˆ** | `java.awt.Container` å’Œ `Component` | `BeanDefinition` æ ‘å½¢ç»“æ„ |
| **è£…é¥°å™¨** | `java.io` åŒ…ï¼ˆ`BufferedInputStream` ç­‰ï¼‰ | Spring AOPï¼ˆåŠŸèƒ½å¢å¼ºï¼‰ |
| **å¤–è§‚** | `java.net.URL` | `JdbcTemplate`ï¼ˆç®€åŒ– JDBCï¼‰ |
| **äº«å…ƒ** | `String` å¸¸é‡æ± ã€`Integer` ç¼“å­˜ | çº¿ç¨‹æ± ã€è¿æ¥æ±  |
| **ä»£ç†** | `java.lang.reflect.Proxy` | Spring AOPï¼ˆJDK/CGLIBï¼‰ |

### å…³é”®æ€»ç»“

```mermaid
graph LR
    A[ç»“æ„å‹æ¨¡å¼æ ¸å¿ƒç›®æ ‡] --> B[é€šè¿‡ç»„åˆè·å¾—æ›´å¤§ç»“æ„]
    
    B --> C[é€‚é…å™¨<br/>æ¥å£è½¬æ¢]
    B --> D[æ¡¥æ¥<br/>æŠ½è±¡ä¸å®ç°åˆ†ç¦»]
    B --> E[ç»„åˆ<br/>æ ‘å½¢ç»“æ„]
    B --> F[è£…é¥°å™¨<br/>åŠ¨æ€æ‰©å±•]
    B --> G[å¤–è§‚<br/>ç®€åŒ–æ¥å£]
    B --> H[äº«å…ƒ<br/>å…±äº«å¯¹è±¡]
    B --> I[ä»£ç†<br/>æ§åˆ¶è®¿é—®]
    
    C --> J[é€‚ç”¨ï¼šæ¥å£ä¸å…¼å®¹]
    D --> K[é€‚ç”¨ï¼šé¿å…ç±»çˆ†ç‚¸]
    E --> L[é€‚ç”¨ï¼šéƒ¨åˆ†-æ•´ä½“]
    F --> M[é€‚ç”¨ï¼šåŠ¨æ€æ·»åŠ åŠŸèƒ½]
    G --> N[é€‚ç”¨ï¼šç®€åŒ–å¤æ‚ç³»ç»Ÿ]
    H --> O[é€‚ç”¨ï¼šå¤§é‡ç›¸ä¼¼å¯¹è±¡]
    I --> P[é€‚ç”¨ï¼šè®¿é—®æ§åˆ¶]
```

---

# åã€é¢è¯•é«˜é¢‘é—®é¢˜

## é¢˜ç›® 1ï¼šè¯·è¯´å‡º 7 ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå¹¶è¯´è¯´å®ƒä»¬çš„åŒºåˆ«ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

7 ç§ç»“æ„å‹æ¨¡å¼ï¼š
1. **é€‚é…å™¨æ¨¡å¼**ï¼šè®©ä¸å…¼å®¹çš„æ¥å£ååŒå·¥ä½œ
2. **æ¡¥æ¥æ¨¡å¼**ï¼šå°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œé¿å…ç±»çˆ†ç‚¸
3. **ç»„åˆæ¨¡å¼**ï¼šæ ‘å½¢ç»“æ„ï¼Œç»Ÿä¸€å¤„ç†å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡
4. **è£…é¥°å™¨æ¨¡å¼**ï¼šåŠ¨æ€æ‰©å±•åŠŸèƒ½ï¼Œé¿å…ç±»çˆ†ç‚¸
5. **å¤–è§‚æ¨¡å¼**ï¼šä¸ºå¤æ‚å­ç³»ç»Ÿæä¾›ç®€å•æ¥å£
6. **äº«å…ƒæ¨¡å¼**ï¼šå…±äº«ç»†ç²’åº¦å¯¹è±¡ï¼ŒèŠ‚çœå†…å­˜
7. **ä»£ç†æ¨¡å¼**ï¼šæ§åˆ¶å¯¹è±¡è®¿é—®ï¼Œå»¶è¿ŸåŠ è½½ã€æƒé™æ§åˆ¶

**åŒºåˆ«**ï¼š
- **é€‚é…å™¨**å…³æ³¨æ¥å£è½¬æ¢
- **æ¡¥æ¥**å…³æ³¨æŠ½è±¡ä¸å®ç°åˆ†ç¦»
- **ç»„åˆ**å…³æ³¨æ ‘å½¢ç»“æ„
- **è£…é¥°å™¨**å…³æ³¨åŠŸèƒ½æ‰©å±•
- **å¤–è§‚**å…³æ³¨ç®€åŒ–æ¥å£
- **äº«å…ƒ**å…³æ³¨å¯¹è±¡å…±äº«
- **ä»£ç†**å…³æ³¨è®¿é—®æ§åˆ¶

---

## é¢˜ç›® 2ï¼šé€‚é…å™¨æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

| ç»´åº¦ | é€‚é…å™¨æ¨¡å¼ | è£…é¥°å™¨æ¨¡å¼ |
|------|-----------|-----------|
| **ç›®çš„** | è½¬æ¢æ¥å£ï¼Œè®©ä¸å…¼å®¹çš„æ¥å£ååŒå·¥ä½œ | å¢å¼ºåŠŸèƒ½ï¼ŒåŠ¨æ€æ·»åŠ èŒè´£ |
| **å…³ç³»** | é€‚é…å™¨å’Œè¢«é€‚é…è€…é€šå¸¸æ²¡æœ‰ç»§æ‰¿å…³ç³» | è£…é¥°å™¨å’Œè¢«è£…é¥°è€…å®ç°åŒä¸€æ¥å£ |
| **ä½¿ç”¨åœºæ™¯** | éœ€è¦ä½¿ç”¨ç°æœ‰ç±»ä½†æ¥å£ä¸åŒ¹é… | éœ€è¦åŠ¨æ€æ·»åŠ åŠŸèƒ½ |
| **å…³æ³¨ç‚¹** | æ¥å£å…¼å®¹æ€§ | åŠŸèƒ½æ‰©å±• |

**ä¸¾ä¾‹**ï¼š
- **é€‚é…å™¨**ï¼š`InputStreamReader` å°†å­—èŠ‚æµé€‚é…ä¸ºå­—ç¬¦æµ
- **è£…é¥°å™¨**ï¼š`BufferedInputStream` ä¸º `InputStream` æ·»åŠ ç¼“å†²åŠŸèƒ½

---

## é¢˜ç›® 3ï¼šä»£ç†æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

| ç»´åº¦ | ä»£ç†æ¨¡å¼ | è£…é¥°å™¨æ¨¡å¼ |
|------|---------|-----------|
| **ç›®çš„** | æ§åˆ¶è®¿é—®ï¼ˆå»¶è¿ŸåŠ è½½ã€æƒé™æ§åˆ¶ï¼‰ | å¢å¼ºåŠŸèƒ½ï¼ˆæ·»åŠ æ–°åŠŸèƒ½ï¼‰ |
| **å…³ç³»** | ä»£ç†å’Œè¢«ä»£ç†é€šå¸¸æœ‰å›ºå®šå…³ç³» | è£…é¥°å™¨å’Œè¢«è£…é¥°è€…å¯ä»¥ç‹¬ç«‹å˜åŒ– |
| **å…³æ³¨ç‚¹** | è®¿é—®æ§åˆ¶ | åŠŸèƒ½æ‰©å±• |
| **ä½¿ç”¨åœºæ™¯** | å»¶è¿ŸåŠ è½½ã€æƒé™æ§åˆ¶ã€æ—¥å¿—è®°å½• | åŠ¨æ€æ·»åŠ åŠŸèƒ½ |

**å…³é”®åŒºåˆ«**ï¼š
- **ä»£ç†æ¨¡å¼**ï¼šä»£ç†å¯¹è±¡æ§åˆ¶å¯¹åŸå¯¹è±¡çš„è®¿é—®ï¼Œé€šå¸¸ä¸æ”¹å˜åŸå¯¹è±¡çš„åŠŸèƒ½
- **è£…é¥°å™¨æ¨¡å¼**ï¼šè£…é¥°å™¨å¯¹è±¡å¢å¼ºåŸå¯¹è±¡çš„åŠŸèƒ½ï¼Œæ·»åŠ æ–°çš„èŒè´£

**ä¸¾ä¾‹**ï¼š
- **ä»£ç†**ï¼šSpring AOP ä»£ç†æ§åˆ¶æ–¹æ³•è°ƒç”¨ï¼ˆæ·»åŠ äº‹åŠ¡ã€æ—¥å¿—ï¼‰
- **è£…é¥°å™¨**ï¼š`BufferedInputStream` ä¸º `InputStream` æ·»åŠ ç¼“å†²åŠŸèƒ½

---

## é¢˜ç›® 4ï¼šJDK åŠ¨æ€ä»£ç†å’Œ CGLIB æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

| ç»´åº¦ | JDK åŠ¨æ€ä»£ç† | CGLIB |
|------|------------|-------|
| **å®ç°æ–¹å¼** | å®ç°æ¥å£ | ç»§æ‰¿ç±» |
| **è¦æ±‚** | ç›®æ ‡ç±»å¿…é¡»å®ç°æ¥å£ | ç›®æ ‡ç±»ä¸èƒ½æ˜¯ final |
| **æ€§èƒ½** | ç•¥å¿«ï¼ˆJDK 8+ï¼‰ | ç•¥æ…¢ï¼ˆä½†å·®è·å¾ˆå°ï¼‰ |
| **ä¾èµ–** | JDK è‡ªå¸¦ | éœ€è¦å¼•å…¥ CGLIB |
| **åŸç†** | é€šè¿‡ `Proxy` ç±»ç”Ÿæˆä»£ç†ç±» | é€šè¿‡ç»§æ‰¿ç”Ÿæˆå­ç±» |

**Spring çš„é€‰æ‹©**ï¼š
- å¦‚æœ Bean å®ç°äº†æ¥å£ â†’ ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†
- å¦‚æœ Bean æ²¡æœ‰å®ç°æ¥å£ â†’ ä½¿ç”¨ CGLIB

**ä»£ç ç¤ºä¾‹**ï¼š
```java
// JDK åŠ¨æ€ä»£ç†
UserService proxy = (UserService) Proxy.newProxyInstance(...);

// CGLIB
UserService proxy = (UserService) enhancer.create();
```

---

## é¢˜ç›® 5ï¼šæ¡¥æ¥æ¨¡å¼å’Œé€‚é…å™¨æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

| ç»´åº¦ | æ¡¥æ¥æ¨¡å¼ | é€‚é…å™¨æ¨¡å¼ |
|------|---------|-----------|
| **ç›®çš„** | å°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œé¿å…ç±»çˆ†ç‚¸ | è®©ä¸å…¼å®¹çš„æ¥å£ååŒå·¥ä½œ |
| **ä½¿ç”¨æ—¶æœº** | è®¾è®¡é˜¶æ®µï¼Œé¢„å…ˆè®¾è®¡ | å·²æœ‰ç³»ç»Ÿï¼Œéœ€è¦é›†æˆ |
| **å…³æ³¨ç‚¹** | æŠ½è±¡ä¸å®ç°çš„è§£è€¦ | æ¥å£è½¬æ¢ |
| **å…³ç³»** | æŠ½è±¡å’Œå®ç°å¯ä»¥ç‹¬ç«‹å˜åŒ– | é€‚é…å™¨é€‚é…å·²æœ‰æ¥å£ |

**å…³é”®åŒºåˆ«**ï¼š
- **æ¡¥æ¥æ¨¡å¼**ï¼šåœ¨**è®¾è®¡é˜¶æ®µ**ä½¿ç”¨ï¼Œå°†æŠ½è±¡å’Œå®ç°åˆ†ç¦»ï¼Œé¿å…ç±»çˆ†ç‚¸
- **é€‚é…å™¨æ¨¡å¼**ï¼šåœ¨**å·²æœ‰ç³»ç»Ÿ**ä¸­ä½¿ç”¨ï¼Œè®©ä¸å…¼å®¹çš„æ¥å£ååŒå·¥ä½œ

**ä¸¾ä¾‹**ï¼š
- **æ¡¥æ¥**ï¼šå›¾å½¢ç³»ç»Ÿï¼ˆå½¢çŠ¶ Ã— é¢œè‰²ï¼‰ï¼Œé¿å…ä¸ºæ¯ç§ç»„åˆåˆ›å»ºç±»
- **é€‚é…å™¨**ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹æ’­æ”¾å™¨ï¼Œä½†æ¥å£ä¸åŒ¹é…ï¼Œéœ€è¦é€‚é…

---

## é¢˜ç›® 6ï¼šç»„åˆæ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

| ç»´åº¦ | ç»„åˆæ¨¡å¼ | è£…é¥°å™¨æ¨¡å¼ |
|------|---------|-----------|
| **ç›®çš„** | æ ‘å½¢ç»“æ„ï¼Œç»Ÿä¸€å¤„ç†å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡ | åŠ¨æ€æ‰©å±•åŠŸèƒ½ |
| **ç»“æ„** | æ ‘å½¢ç»“æ„ï¼ˆéƒ¨åˆ†-æ•´ä½“ï¼‰ | é“¾å¼ç»“æ„ï¼ˆåŒ…è£…å™¨é“¾ï¼‰ |
| **å…³æ³¨ç‚¹** | å¯¹è±¡ç»„åˆ | åŠŸèƒ½æ‰©å±• |
| **ä½¿ç”¨åœºæ™¯** | æ–‡ä»¶ç³»ç»Ÿã€ç»„ç»‡æ¶æ„ | åŠ¨æ€æ·»åŠ åŠŸèƒ½ |

**å…³é”®åŒºåˆ«**ï¼š
- **ç»„åˆæ¨¡å¼**ï¼šå…³æ³¨**å¯¹è±¡ç»„åˆ**ï¼Œå½¢æˆæ ‘å½¢ç»“æ„ï¼Œç»Ÿä¸€å¤„ç†å¶å­èŠ‚ç‚¹å’Œç»„åˆèŠ‚ç‚¹
- **è£…é¥°å™¨æ¨¡å¼**ï¼šå…³æ³¨**åŠŸèƒ½æ‰©å±•**ï¼Œå½¢æˆé“¾å¼ç»“æ„ï¼ŒåŠ¨æ€æ·»åŠ åŠŸèƒ½

**ä¸¾ä¾‹**ï¼š
- **ç»„åˆ**ï¼šæ–‡ä»¶ç³»ç»Ÿï¼ˆæ–‡ä»¶ + æ–‡ä»¶å¤¹ï¼‰ï¼Œç»Ÿä¸€æ˜¾ç¤º
- **è£…é¥°å™¨**ï¼šå’–å•¡åŠ æ–™ï¼ˆå’–å•¡ + ç‰›å¥¶ + ç³–ï¼‰ï¼ŒåŠ¨æ€ç»„åˆ

---

## é¢˜ç›® 7ï¼šäº«å…ƒæ¨¡å¼çš„åº”ç”¨åœºæ™¯ï¼ŸString å¸¸é‡æ± æ˜¯äº«å…ƒæ¨¡å¼å—ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

**äº«å…ƒæ¨¡å¼çš„åº”ç”¨åœºæ™¯**ï¼š
1. ç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡ç›¸ä¼¼å¯¹è±¡
2. è¿™äº›å¯¹è±¡çš„å¤§éƒ¨åˆ†çŠ¶æ€å¯ä»¥å…±äº«
3. éœ€è¦ç¼“å†²æ± çš„åœºæ™¯ï¼ˆçº¿ç¨‹æ± ã€è¿æ¥æ± ï¼‰

**String å¸¸é‡æ± æ˜¯äº«å…ƒæ¨¡å¼**ï¼š
```java
String s1 = "hello";
String s2 = "hello";
System.out.println(s1 == s2); // trueï¼ˆå…±äº«åŒä¸€ä¸ªå¯¹è±¡ï¼‰
```

- `"hello"` æ˜¯å†…éƒ¨çŠ¶æ€ï¼ˆå…±äº«ï¼‰
- å­—ç¬¦ä¸²å¯¹è±¡è¢«ç¼“å­˜åœ¨å¸¸é‡æ± ä¸­
- ç›¸åŒçš„å­—ç¬¦ä¸²å­—é¢é‡å…±äº«åŒä¸€ä¸ªå¯¹è±¡

**å…¶ä»–äº«å…ƒæ¨¡å¼çš„åº”ç”¨**ï¼š
- `Integer` ç¼“å­˜ï¼ˆ-128 åˆ° 127ï¼‰
- çº¿ç¨‹æ± ï¼ˆçº¿ç¨‹å¯¹è±¡å¤ç”¨ï¼‰
- è¿æ¥æ± ï¼ˆè¿æ¥å¯¹è±¡å¤ç”¨ï¼‰

---

## é¢˜ç›® 8ï¼šSpring AOP ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆä»£ç†ï¼Ÿå¦‚ä½•é€‰æ‹©ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

**Spring AOP çš„ä»£ç†é€‰æ‹©**ï¼š
1. **å¦‚æœ Bean å®ç°äº†æ¥å£** â†’ ä½¿ç”¨ **JDK åŠ¨æ€ä»£ç†**
2. **å¦‚æœ Bean æ²¡æœ‰å®ç°æ¥å£** â†’ ä½¿ç”¨ **CGLIB**

**å¼ºåˆ¶ä½¿ç”¨ CGLIB**ï¼š
```java
@EnableAspectJAutoProxy(proxyTargetClass = true)
```

**ä»£ç ç¤ºä¾‹**ï¼š
```java
// æœ‰æ¥å£ â†’ JDK åŠ¨æ€ä»£ç†
public interface UserService { }
@Service
public class UserServiceImpl implements UserService { }

// æ— æ¥å£ â†’ CGLIB
@Service
public class UserService { }
```

**ä¸ºä»€ä¹ˆè¿™æ ·é€‰æ‹©**ï¼š
- JDK åŠ¨æ€ä»£ç†åªèƒ½ä»£ç†æ¥å£ï¼Œæ€§èƒ½ç•¥å¥½
- CGLIB å¯ä»¥ä»£ç†ç±»ï¼Œä½†éœ€è¦ç»§æ‰¿ï¼Œä¸èƒ½ä»£ç† final ç±»

---

## é¢˜ç›® 9ï¼šå¤–è§‚æ¨¡å¼å’Œé€‚é…å™¨æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

| ç»´åº¦ | å¤–è§‚æ¨¡å¼ | é€‚é…å™¨æ¨¡å¼ |
|------|---------|-----------|
| **ç›®çš„** | ç®€åŒ–æ¥å£ï¼Œéšè—å¤æ‚æ€§ | è½¬æ¢æ¥å£ï¼Œè®©ä¸å…¼å®¹çš„æ¥å£ååŒå·¥ä½œ |
| **å…³æ³¨ç‚¹** | ç®€åŒ–ä½¿ç”¨ | æ¥å£å…¼å®¹ |
| **å…³ç³»** | å¤–è§‚æ˜¯å­ç³»ç»Ÿçš„ç®€åŒ–æ¥å£ | é€‚é…å™¨æ˜¯æ¥å£è½¬æ¢å™¨ |
| **ä½¿ç”¨åœºæ™¯** | ä¸ºå¤æ‚å­ç³»ç»Ÿæä¾›ç®€å•æ¥å£ | è®©ä¸å…¼å®¹çš„æ¥å£ååŒå·¥ä½œ |

**å…³é”®åŒºåˆ«**ï¼š
- **å¤–è§‚æ¨¡å¼**ï¼šä¸º**å¤æ‚å­ç³»ç»Ÿ**æä¾›**ç®€å•æ¥å£**ï¼Œéšè—å¤æ‚æ€§
- **é€‚é…å™¨æ¨¡å¼**ï¼šè®©**ä¸å…¼å®¹çš„æ¥å£**ååŒå·¥ä½œï¼Œè½¬æ¢æ¥å£

**ä¸¾ä¾‹**ï¼š
- **å¤–è§‚**ï¼š`JdbcTemplate` ç®€åŒ– JDBC æ“ä½œ
- **é€‚é…å™¨**ï¼š`InputStreamReader` å°†å­—èŠ‚æµé€‚é…ä¸ºå­—ç¬¦æµ

---

## é¢˜ç›® 10ï¼šå®é™…é¡¹ç›®ä¸­ä½ ç”¨è¿‡å“ªäº›ç»“æ„å‹æ¨¡å¼ï¼Ÿ

**å‚è€ƒç­”æ¡ˆ**ï¼š

**å¸¸ç”¨åœºæ™¯**ï¼š

1. **é€‚é…å™¨æ¨¡å¼**ï¼š
   - é›†æˆç¬¬ä¸‰æ–¹ SDKï¼Œæ¥å£ä¸åŒ¹é…æ—¶ä½¿ç”¨é€‚é…å™¨
   - ç³»ç»Ÿå‡çº§ï¼Œæ–°æ—§æ¥å£å…¼å®¹

2. **è£…é¥°å™¨æ¨¡å¼**ï¼š
   - Java IO æµï¼ˆ`BufferedInputStream`ã€`DataInputStream`ï¼‰
   - ä¸ºåŠŸèƒ½åŠ¨æ€æ·»åŠ å¢å¼ºï¼ˆæ—¥å¿—ã€ç¼“å­˜ï¼‰

3. **ä»£ç†æ¨¡å¼**ï¼š
   - Spring AOPï¼ˆäº‹åŠ¡ã€æ—¥å¿—ï¼‰
   - MyBatis Mapper æ¥å£
   - RPC æ¡†æ¶ï¼ˆè¿œç¨‹ä»£ç†ï¼‰

4. **å¤–è§‚æ¨¡å¼**ï¼š
   - `JdbcTemplate` ç®€åŒ– JDBC
   - å°è£…å¤æ‚å­ç³»ç»Ÿï¼Œæä¾›ç®€å•æ¥å£

5. **äº«å…ƒæ¨¡å¼**ï¼š
   - çº¿ç¨‹æ± ã€è¿æ¥æ± 
   - ç¼“å­˜å¸¸ç”¨å¯¹è±¡

6. **ç»„åˆæ¨¡å¼**ï¼š
   - èœå•ç³»ç»Ÿ
   - æƒé™æ ‘

7. **æ¡¥æ¥æ¨¡å¼**ï¼š
   - å¤šç»´åº¦å˜åŒ–çš„åœºæ™¯ï¼ˆé¿å…ç±»çˆ†ç‚¸ï¼‰

---

> **è¯¾ä»¶ç»“æŸ**ã€‚å»ºè®®é…åˆ `code/` ç›®å½•ä¸‹çš„å®éªŒä»£ç ä¸€èµ·å­¦ä¹ ï¼ŒåŠ¨æ‰‹å®è·µæ•ˆæœæ›´å¥½ã€‚
